<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haven VCQL Helper</title>
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/CathieNova/Haven-Tools-and-Helpers/refs/heads/main/res/favicon.ico">
    <link rel="stylesheet" type="text/css" href="css/vcqlhelper.css">
</head>
<body>
    <button id="toggleTopRightBoxBtn" onclick="toggleTopRightBox()" style="position: absolute; right: 10px; top: 0px; padding: 5px 10px; width: auto;">
        Hide Navigation & Page Settings
    </button>
    <div id="support-me">
        <a href="https://ko-fi.com/cathienova" target="_blank">
            <img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png" alt="Buy Me A Coffee">
        </a>
    </div>
    <div id="top-right-box">
        <section id="header" style="display: block; position: relative; background-color: #1a1a1a; padding-top: 15px; padding-bottom: 0px; border-radius: 10px; box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.6);">
            <h3 style="color: #ff7920;"><strong>Website Navigation</strong>
                <button id="header-button" onclick="openURL('home')">Home</button>
                <button id="header-button" onclick="openURL('vcqlhelper')">Haven VCQL Helper</button>
                <button id="header-button" onclick="openURL('itemdatabase')">Haven Item Database</button>
                <button id="header-button" onclick="openURL('traderassort')">Haven Trader Assort Generator</button>
                <button id="header-button" onclick="openURL('modslots')">Haven Mod Slot Generator</button>
                <button id="header-button" onclick="openURL('hideoutcraft')">Haven Hideout Crafting Generator</button>
        </section>
        <section id="header" style="display: block; position: relative; background-color: #1a1a1a; padding-top: 15px; padding-bottom: 0px; border-radius: 10px; box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.6);">
        <h3 style="color: #ff7920;"><strong>VCQL Page Settings</strong></h3>
        <label for="spt-version">SPT Version:</label>
        <select id="spt-version" onchange="handleSPTVersionChange()">
            <option value="3.9.8">SPT 3.9.8</option>
            <option value="3.10">SPT 3.10</option>
        </select>
        <div class="language-container" id="language-container" style="text-align: left;">
            <label class="language-select-label" for="language-select">Item Names Language: </label>
            <select class="language-select" id="language-select" onchange="loadLanguage(this.value)">
                <option value="en.json" selected>English</option>
                <option value="cz.json">Czech</option>
                <option value="fr.json">French</option>
                <option value="ge.json">German</option>
                <option value="hu.json">Hungarian</option>
                <option value="it.json">Italian</option>
                <option value="jp.json">Japanese</option>
                <option value="kr.json">Korean</option>
                <option value="pl.json">Polish</option>
                <option value="po.json">Portuguese</option>
                <option value="ro.json">Romanian</option>
                <option value="ru.json">Russian</option>
                <option value="sk.json">Slovak</option>
                <option value="ch.json">Chinese</option>
                <option value="es.json">Spanish</option>
                <option value="es-mx.json">Mexican Spanish</option>
                <option value="tu.json">Turkish</option>
            </select>
        </div>

        <button class="top-right-button" id="toggleMainContentBtn" onclick="toggleMainContent()">Hide Main Content</button>
        <button class="top-right-button" id="toggleUsefulInfoBtn" onclick="toggleUsefulInfo()">Show Useful Info</button>
        <button class="top-right-button" id="toggleHowToUseBtn" onclick="toggleHowToUse()">Show How to Use</button>
        <p>
        <button class="top-right-button" id="reloadButton" onclick="reloadPage()">Reset Quest Info</button>
        </section>
    </div>
    
    <div class="content-container">
        <section id="main-content">
            <h1 style="color: #ff7920;">Haven VCQL Helper</h1>
            <h4>Made for <a href="https://hub.sp-tarkov.com/files/file/885-virtual-s-custom-quest-loader/" target="_blank" style="color: #4db8ff; text-decoration: underline;">Virtual's Custom Quest Loader</a> - SPT Mod</h4>
            <h4>Haven VCQL Helper is a tool to help you create quests for Virtual's Custom Quest Loader, if you don't know how to make quests then see the <strong style="color: #06b600;">How To Use</strong> section on the right side.</h4>
            <h4 style="color: red;">For any issues or suggestions, please post them on <a href="https://github.com/CathieNova/Haven-Tools-and-Helpers/issues" target="_blank" style="color: #4db8ff; text-decoration: underline;">Github</a></h4>
        </section>
        
        <section id="useful-info" style="display: none; position: relative; background-color: #1a1a1a; padding: 20px; border-radius: 10px; box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.6);">
            <strong style="color: #ffdd57; font-size: 1.4em; display: block; margin-bottom: 10px;">üìò Useful Info:</strong>
            <ul style="list-style: none; padding-left: 0; color: #e0e0e0; font-size: 1.1em; line-height: 1.6;">
                <li><a href="https://hub.sp-tarkov.com/doc/entry/7-resources-item-properties-list/" target="_blank" style="color: #4db8ff; text-decoration: underline;">Item Resource List</a></li>
                <li><a href="https://hub.sp-tarkov.com/doc/entry/57-resources-quest-values-reference-tool/" target="_blank" style="color: #4db8ff; text-decoration: underline;">Quest Values Reference Tool</a></li>
                <li><a href="https://raw.githubusercontent.com/RuKira/SPT-AllInOne/refs/heads/main/SPT-AllInOne/Data/quests.json" target="_blank" style="color: #4db8ff; text-decoration: underline;">EFT Default Quest References</a></li>
                <li><a href="https://tarkov-market.com/" target="_blank" style="color: #4db8ff; text-decoration: underline;">Tarkov Market</a></li>
            </ul>
            <strong style="color: #ffdd57; font-size: 1.2em; display: block; margin-top: 15px; margin-bottom: 10px;">üìç Zone ID List for Conditions</strong>
            <ul style="list-style: none; padding-left: 0; color: #e0e0e0; font-size: 1.1em; line-height: 1.6;">
                <li><a href="https://github.com/guillaumearm/SPT_CustomQuests/blob/master/docs/ALL_ZONES.md" target="_blank" style="color: #4db8ff; text-decoration: underline;">Guillaunearm's Zones IDs</a></li>
                <li><a href="https://github.com/guillaumearm/SPT_CustomQuests/blob/master/docs/ALL_PLACES.md" target="_blank" style="color: #4db8ff; text-decoration: underline;">Guillaunearm's Places IDs</a></li>
                <li><a href="https://hub.sp-tarkov.com/doc/entry/72-resources-all-zone-id-s/" target="_blank" style="color: #4db8ff; text-decoration: underline;">LrightoftheWorld's All Zone IDs</a></li>
                <li><a href="https://hub.sp-tarkov.com/doc/entry/75-map-zones/" target="_blank" style="color: #4db8ff; text-decoration: underline;">CreamCheese's Map Zones</a></li>
            </ul>
        </section>
        
        <section id="how-to-use" style="display: none; position: relative; background-color: #1a1a1a; padding: 20px; border-radius: 10px; box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.6);">
            <strong style="color: #ffdd57; font-size: 1.6em; margin-bottom: 15px; display: block;">‚ú® How to Use</strong>
            <h4 style="color: #b60000;">Refreshing the page will reset values</h4>
            <ul style="list-style: none; padding-left: 0; color: #e0e0e0; font-size: 1.2em; line-height: 1.6;">
                <li style="margin-bottom: 15px;"><span style="color: #4db8ff;">üîπ</span> <strong style="color: #06b600;">Quest Name:</strong> Enter the quest name; it will be converted into an ID automatically.</li>
                <li style="margin-bottom: 15px;"><span style="color: #4db8ff;">üîπ</span> <strong style="color: #06b600;">Trader Name:</strong> Specify the trader who assigns the quest.</li>
                <li style="margin-bottom: 15px;"><span style="color: #4db8ff;">üîπ</span> <strong style="color: #06b600;">Objective Conditions:</strong> Define requirements like finding items, kills, or visits.</li>
                <li style="margin-bottom: 15px;"><span style="color: #4db8ff;">üîπ</span> <strong style="color: #06b600;">Quest Location:</strong> Select the map this quest is focused in.</li>
                <br>
                <li style="margin-top: 15px; font-weight: bold; color: #ffdd57;">üöÅ Objectives:</li>
                <ul style="padding-left: 30px; color: #b0b0b0;">
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Find Item:</strong> Locate specific items within a raid.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Target Items:</strong> Specify item(s) to locate.</li>
                            <li><strong style="color: #ff7037;">Value:</strong> Set the quantity needed.</li>
                            <li><strong style="color: #ff7037;">Only Found In Raid:</strong> Check if items must be raid-found.</li>
                            <li><strong style="color: #ff7037;">Visibility Condition:</strong> Hide the objective until another objective is completed.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Handover Item:</strong> Deliver specified items to the trader.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li>Similar to "Find Item" but involves giving items to the trader.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Kills:</strong> Set targets for elimination.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Location:</strong> Location for kills (e.g., Factory, Customs).</li>
                            <li><strong style="color: #ff7037;">Target:</strong> Target type (Scavs, PMCs, etc.).</li>
                            <li><strong style="color: #ff7037;">Kills Required:</strong> Number of kills needed.</li>
                            <li><strong style="color: #ff7037;">Distance Comparison:</strong> Set distance parameters (e.g., ‚â• 50 meters).</li>
                            <li><strong style="color: #ff7037;">Time of Day From/To:</strong> Enter time range (0-24; e.g., 6 = 6 AM).</li>
                            <li><strong style="color: #ff7037;">Target Body Part:</strong> Specify body part, if applicable.</li>
                            <li><strong style="color: #ff7037;">Visibility Condition:</strong> Hide the objective until another objective is completed.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">InZone:</strong> Set a specific zone requirement for kills, item drop, or visits.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Zone ID:</strong> Enter the zone ID (refer to Zones IDs link).</li>
                            <li><strong style="color: #ff7037;">Visibility Condition:</strong> Hide the objective until another objective is completed.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">LeaveItemAtLocation:</strong> Set a specific location requirement for item drop.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Target Zone ID:</strong> Enter the zone ID.</li>
                            <li><strong style="color: #ff7037;">Plant Time:</strong> Time in seconds to plant the item.</li>
                            <li><strong style="color: #ff7037;">Value:</strong> Quantity of the item to plant.</li>
                            <li><strong style="color: #ff7037;">MinDurability/MaxDurability:</strong> Set durability range.</li>
                            <li><strong style="color: #ff7037;">OnlyFoundInRaid:</strong> Check if the item must be raid-found.</li>
                            <li><strong style="color: #ff7037;">Visibility Condition:</strong> Hide the objective until another objective is completed.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Visit Place:</strong> Set a specific location visit requirement.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Target Zone ID:</strong> Enter the zone ID for the location.</li>
                            <li><strong style="color: #ff7037;">Visibility Condition:</strong> Hide the objective until another objective is completed.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Skill:</strong> Require a certain level in a specified skill.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Compare Method:</strong> Choose ‚â• or ‚â§ for level comparison.</li>
                            <li><strong style="color: #ff7037;">Skill Type:</strong> Select the skill (e.g., Endurance).</li>
                            <li><strong style="color: #ff7037;">Required Skill Level:</strong> Enter the target level.</li>
                            <li><strong style="color: #ff7037;">Visibility Condition:</strong> Hide the objective until another objective is completed.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Equipment:</strong> Set requirements for equipped or excluded items.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Items to Equip:</strong> Add items the player must equip.</li>
                            <li><strong style="color: #ff7037;">Items to Exclude:</strong> Specify items to avoid equipping.</li>
                            <li><strong style="color: #ff7037;">Visibility Condition:</strong> Hide the objective until another objective is completed.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Location:</strong> Specify locations where conditions apply.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li>Select multiple locations if required (e.g., Interchange, Woods).</li>
                            <li><strong style="color: #ff7037;">Visibility Condition:</strong> Hide the objective until another objective is completed.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Exit Status:</strong> Define conditions for exit.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Status:</strong> Choose one or multiple statuses (e.g., Survived, Killed).</li>
                            <li><strong style="color: #ff7037;">Visibility Condition:</strong> Hide the objective until another objective is completed.</li>
                        </ul>
                    </li>
                </ul>
                <li style="margin-top: 15px; font-weight: bold; color: #ffdd57;">üéÅ Rewards:</li>
                <ul style="padding-left: 30px; color: #b0b0b0;">
                    <li><strong style="color: #06b600;">Experience:</strong> Award player experience points.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Value:</strong> Amount of experience awarded.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Trader Standing:</strong> Adjust standing with a trader.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Value:</strong> Amount to increase/decrease reputation.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Item:</strong> Reward the player with specific items.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Item:</strong> Select from the dropdown or enter ID.</li>
                            <li><strong style="color: #ff7037;">Value:</strong> Quantity of the item rewarded.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Assortment Unlock:</strong> Unlock items in the trader‚Äôs inventory.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Item ID:</strong> Enter the item‚Äôs ID to unlock.</li>
                            <li><strong style="color: #ff7037;">Loyalty Level:</strong> Required loyalty level to access.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Skill:</strong> Increase a specific skill.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Skill Type:</strong> Choose the skill to enhance.</li>
                            <li><strong style="color: #ff7037;">Value:</strong> Increase level by specified amount.</li>
                        </ul>
                    </li>
                </ul>
                <li style="margin-top: 15px; font-weight: bold; color: #ffdd57;">‚ö†Ô∏è Fail Conditions:</li>
                <ul style="padding-left: 30px; color: #b0b0b0;">
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Level:</strong> Set a fail condition based on player level.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Compare Method:</strong> Choose ‚â• or ‚â§ for level comparison.</li>
                            <li><strong style="color: #ff7037;">Value:</strong> Enter the target level.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Location:</strong> Set a fail condition based on the Map, must have a secondary condition.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Locations:</strong> Select the map(s) for the condition.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Quest: </strong> Set a fail condition based on another quest.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Quest ID:</strong> Enter the quest ID to fail.</li>
                            <li><strong style="color: #ff7037;">Status:</strong> Choose the status of the Quest ID to fail the quest, for example if you complete "Debut" it will fail this quest.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Kills: </strong> Set a fail condition based on kills.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Target:</strong> Target type (Scavs, PMCs, etc.).</li>
                            <li><strong style="color: #ff7037;">If Scavs is selected:</strong> The Bosses can be selected, if the Bosses selected are killed it will fail the quest.</li>
                            <li><strong style="color: #ff7037;">Kills Required:</strong> Number of kills needed, greater than or less than.</li>
                            <li><strong style="color: #ff7037;">Distance Comparison:</strong> Set distance parameters (e.g., ‚â• 50 meters).</li>
                            <li><strong style="color: #ff7037;">Time of Day From/To:</strong> Enter time range (0-24; e.g., 6 = 6 AM).</li>
                            <li><strong style="color: #ff7037;">Weapon Caliber:</strong> If using these weapon calibers you will fail the quest.</li>
                            <li><strong style="color: #ff7037;">Target Body Part:</strong> Specify body part to hit that will fail the quest, if applicable.</li>
                            <li><strong style="color: #ff7037;">Weapon Mods to include:</strong> If using these weapon mods you will fail the quest.</li>
                            <li><strong style="color: #ff7037;">Weapon Mods to exclude:</strong> If using these weapon mods you will not fail the quest.</li>
                            <li><strong style="color: #ff7037;">Reset on Session End:</strong> If enabled, it will reset the quest if it's failed when the player extracts.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Exit Status:</strong> Set a fail condition based on the player's exit status.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Status:</strong> Choose one or multiple statuses (e.g., Survived, Killed).</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Use Item: </strong> Set a fail condition based on using an item.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Item:</strong> Select the items that will fail the quest if used.</li>
                            <li><strong style="color: #ff7037;">Value:</strong> The amount of the item to use(e.g., ‚â• 2 items).</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Trader Standing:</strong> Set a fail condition based on the trader standing.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Standing Value:</strong> Greater than or less than the level.</li>
                            <li><strong style="color: #ff7037;">Trader ID:</strong> The trader ID to check the standing.</li>
                        </ul>
                    </li>
                    <li style="margin-top: 10px;"><strong style="color: #06b600;">Exit Status On Location:</strong> Set a fail condition based on the player's exit status on a location.
                        <ul style="padding-left: 25px; margin-top: 5px;">
                            <li><strong style="color: #ff7037;">Sub Conditions:</strong> Works the same as Exit Status and Location, it can be combined.</li>
                            <li><strong style="color: #ff7037;">Do Not Reset If Counter Completed:</strong> If enabled, it will not reset the quest if the counter is completed.</li>
                            <li><strong style="color: #ff7037;">One Session Only:</strong> If enabled, it will only allow the quest to be failed once per session.</li>
                        </ul>
                    </li>
                </ul>
            </ul>
        </section>
        
        <!-- Quest Input Section -->
            <h2 style="color: #06b600;">Quest Creation</h2>
            <section id="basic-quest-info" style="position: relative; background-color: #1a1a1a; padding: 20px; border-radius: 10px; box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.6);">
                <h3 style="color: #ff7920;">Basic Quest Information</h3>
                <label style="color: #06b600;" for="quest-name">Quest Name:</label>
                <input type="text" id="quest-name" placeholder="Enter quest name" required>

                <label for="trader-name" style="color: #06b600;">Quest Trader Name:</label>
                <input type="text" id="trader-name" placeholder="Enter Trader name (or mongoId)" required>

                <label for="quest-number" style="color: #06b600;">Quest Number (just for organization purposes)</label>
                <input type="number" id="quest-number" placeholder="Enter Quest Number" required value="0">

                <label for="quest-image" style="color: #06b600;">Quest Image Location:</label>
                <input type="text" id="quest-image" placeholder="/files/quest/icon/Chloe_0.png" required>

                <label for="faction-dropdown" style="color: #06b600;">Faction:</label>
                <select id="faction-dropdown" required>
                    <option value="Pmc">Pmc (both factions)</option>
                    <option value="Bear">Bear</option>
                    <option value="Usec">Usec</option>
                    <option value="Scav" disabled>Scav</option>
                </select>

                <label for="quest-location-dropdown" style="color: #06b600;">Quest Location:</label>
                    <select id="quest-location-dropdown" class="quest-location-dropdown" required>
                        <option value="any" selected>Any</option>
                        <option value="55f2d3fd4bdc2d5f408b4567">Factory Day</option>
                        <option value="59fc81d786f774390775787e">Factory Night</option>
                        <option value="56f40101d2720b2a4d8b45d6">Customs</option>
                        <option value="5704e3c2d2720bac5b8b4567">Woods</option>
                        <option value="5704e4dad2720bb55b8b4567">Lighthouse</option>
                        <option value="5704e554d2720bac5b8b456e">Shoreline</option>
                        <option value="5704e5fad2720bc05b8b4567">Reserve</option>
                        <option value="5714dbc024597771384a510d">Interchange</option>
                        <option value="5b0fc42d86f7744a585f9105">The Lab</option>
                        <option value="5714dc692459777137212e12">Streets</option>
                        <option value="653e6760052c01c1c805532f">Ground Zero</option>
                    </select>

                <label for="quest-type" style="color: #06b600;">Quest Type: (quest icon)</label>
                <select id="quest-type">
                    <option value="PickUp">Pick Up</option>
                    <option value="Completion">Completion</option>
                    <option value="Discover">Discover</option>
                    <option value="Exploration">Exploration</option>
                    <option value="Loyalty">Loyalty</option>
                    <option value="WeaponAssembly">Weapon Assembly</option>
                    <option value="Standing">Standing</option>
                    <option value="Skill">Skill</option>
                    <option value="Merchant">Merchant</option>
                    <option value="Elimination">Elimination</option>
                    <option value="Multi">Multi</option>
                </select>
            </section>

        <section>
            <h3 class="h3-title" style="color: #06b600;">Quest Start Condition</h3>
            <button onclick="addAvailableForStartCondition()">Add Start Condition Requirement</button>
            <div id="available-for-start-container" class="dynamic-fields"></div>
        </section>

        <section>
            <h3 class="h3-title" style="color: #06b600;">Quest Start Rewards</h3>
            <button onclick="addStartedReward()">Add Start Rewards</button>
            <div id="started-rewards-container" class="dynamic-fields"></div>
        </section>

        <section>
            <h3 style="color: #06b600;">Quest Objective Conditions</h3>
            <button onclick="addCondition()" style="margin-bottom: 10px;">Add Quest Requirement Condition</button>
            <div id="conditions-container" class="dynamic-fields"></div>
        </section>

        <section>
            <h3 class="h3-title" style="color: #06b600;">Quest Fail Conditions</h3>
            <button onclick="addFailCondition()" style="margin-bottom: 10px;">Add Fail Condition</button>
            <div id="fail-conditions-container" class="dynamic-fields"></div>
        </section>

        <section>
            <h3 style="color: #06b600;">Quest Complete Rewards</h3>
            <button onclick="addReward()" style="margin-bottom: 10px;">Add Quest Reward</button>
            <div id="rewards-container" class="dynamic-fields"></div>
        </section>

            <h3 style="color: #06b600;">Quest Language Variables</h3>
            <div id="language-variables-container" style="margin-bottom: 20px;">
                <section id="language-section">
                    <label style="color: #ff7920;">This is where you will add quest information, any of these fields in the scroll window supports new lines and will convert them to "\n".</label>
                    <div id="language-entries-section" style="background-color: transparent;"></div>
                    <div id="dynamic-lang-variables-container"></div>
                </section>
            </div>

            <!-- Language Variables for Conditions and Rewards -->
            <h3 style="color: #06b600;">Condition & Reward Language Variables</h3>
            <div id="dynamic-lang-variables-container"></div>

            <button onclick="generateQuest()" style="margin-top: 10px;">Generate Quest JSON</button>
        </section>
        
        <section id="quest-output-section" style="display: none; position: relative;">
            <h2 style="color: #06b600;">Quest JSON Output</h2>
            <h4 id="dynamicQuestPath">Copy this to your quest folder inside...</h4>
            <div style="position: relative;">
                <button id="downloadQuestButton" onclick="downloadQuest()" style="position: absolute; right: 180px; top: 35px; padding: 5px 10px; width: auto;">
                    Download Quest as JSON
                </button>
                <button id="copyQuestButton" onclick="copyQuest()" style="position: absolute; right: 10px; top: 35px; padding: 5px 10px; width: auto;">
                    Copy Quest to Clipboard
                </button>
            </div>
            <pre id="output" style="margin-top: 40px; padding: 10px;">Generated quest JSON will appear here...</pre>
        </section>
        
        <section id="language-output-section" style="display: none; position: relative;">
            <h3 style="color: #06b600;">Quest Language Variables</h3>
            <h4 id="dynamicLangPath">Copy this to your language folder inside...</h4>
            <div style="position: relative;">
                <button id="downloadLangButton" onclick="downloadLanguageEntries()" style="position: absolute; right: 205px; top: 15px; padding: 5px 10px; width: auto;">
                    Download Language as JSON
                </button>
                <button id="copyLangButton" onclick="copyLanguageEntries()" style="position: absolute; right: 10px; top: 15px; padding: 5px 10px; width: auto;">
                    Copy Language to Clipboard
                </button>
            </div>
            <pre id="language-output" style="margin-top: 20px; padding: 10px;">Language variables will appear here...</pre>
        </section>
        
        <section id="assortments-output-section" style="display: none; position: relative;">
            <h3 style="color: #06b600;">Quest Assortments</h3>
            <h4>Copy this to your trader json inside either <strong style="color: #9b008e;">base.json</strong> or <strong style="color: #9b008e;">questassort.json</strong> at <strong style="color: #9b008e;">SPT\user\mods\TRADERNAME\db</strong>, e.g., <strong style="color: #9b008e;">questassort.json</strong></h4>
            <div style="position: relative;">
                <button id="copyAssortmentsButton" onclick="copyAssortments()" style="position: absolute; right: 10px; top: 10px; padding: 5px 10px; width: auto;">
                    Copy Assortments to Clipboard
                </button>
                <pre id="assortments-output" style="margin-top: 20px; padding: 10px;">Assortments will appear here...</pre>
            </div>
        </section>

        <script>
            let items = [];
            let languageData = {};
            let selectedWeaponCalibers = [];
            let usefulInfoVisible = false;
            let navigationBoxVisible = true;
            let howToUseVisible = false;

            function openURL(url) {
                if (url === 'home')
                    window.open('https://cathienova.github.io/Haven-Tools-and-Helpers/');
                if (url === 'vcqlhelper')
                    window.open('https://cathienova.github.io/Haven-Tools-and-Helpers/vcqlhelper');
                else if (url === 'itemdatabase')
                    window.open('https://cathienova.github.io/Haven-Tools-and-Helpers/itemdatabase');
                else if (url === 'traderassort')
                    window.open('https://cathienova.github.io/Haven-Tools-and-Helpers/traderassort');
                else if (url === 'modslots')
                    window.open('https://cathienova.github.io/Haven-Tools-and-Helpers/modslots');
                else if (url === 'hideoutcraft')
                    window.open('https://cathienova.github.io/Haven-Tools-and-Helpers/hideoutcrafts');
            }

            document.addEventListener('DOMContentLoaded', () => {
                loadLanguage('en.json');
                loadItems();
                populateLanguageFields();
                weaponCaliberSelection();

                initializeTargetSelectListener();
            });

            function initializeTargetSelectListener() {
                const targetSelect = document.querySelector('select[required]');
                if (targetSelect) {
                    targetSelect.addEventListener('change', savageSelection);
                } else {
                    setTimeout(initializeTargetSelectListener, 500);
                }
            }

            function reloadPage() {
                window.location.reload(true);
            }

            async function loadLanguage(languageFile) {
                try {
                    const response = await fetch(`https://raw.githubusercontent.com/CathieNova/Haven-Tools-and-Helpers/refs/heads/main/lang/${languageFile}`);
                    if (!response.ok) throw new Error(`Error loading language file: ${response.status}`);
                    
                    languageData = await response.json();
                    
                    mapLanguageToItems();
                    
                    const targetItemDivs = document.querySelectorAll('.target-item .dropdown-item');
                    targetItemDivs.forEach(itemDiv => {
                        const itemId = itemDiv.getAttribute('data-value');
                        const item = items.find(i => i._id === itemId);
                        if (item) {
                            itemDiv.textContent = item.displayName;
                        }
                    });
                } catch (error) {
                    console.error("Failed to load language:", error);
                }
            }

            async function loadItems() {
                if (!window.itemsLoaded) {
                    try {
                        const response = await fetch('https://raw.githubusercontent.com/CathieNova/Haven-Tools-and-Helpers/refs/heads/main/database/templates/items.json');
                        if (!response.ok) throw new Error(`Error loading items: ${response.status}`);
                        const allItems = await response.json();

                        items = Object.values(allItems).filter(item => item._id && item._props);

                        mapLanguageToItems();
                        items.sort((a, b) => (a.displayName || '').localeCompare(b.displayName || ''));

                        window.itemsLoaded = true;
                    } catch (error) {
                        console.error("Failed to load items:", error);
                        window.itemsLoaded = false;
                    }
                }
            }

            function mapLanguageToItems() {
                if (!languageData || !items) return;

                items.forEach(item => {
                    const itemId = item._id;
                    const shortNameKey = `${itemId} ShortName`;
                    const nameKey = `${itemId} Name`;

                    item.displayName = languageData[nameKey] || languageData[shortNameKey] || item._props.Name;
                });

                items.sort((a, b) => (a.displayName || '').localeCompare(b.displayName || ''));
            }

            document.addEventListener('click', (event) => {
                const isDropdownItem = event.target.classList.contains('dropdown-item');
                const isSearchInput = event.target.classList.contains('dropdown-search');

                if (isDropdownItem) {
                    selectDropdownItem(event.target);
                } else if (!isSearchInput) {
                    document.querySelectorAll('.dropdown-menu').forEach(menu => menu.classList.remove('show'));
                }
            });

            document.addEventListener('change', function(event) {
                if (event.target.classList.contains('compare-method-select')) {
                    detailsDiv.querySelectorAll('.compare-method-select').forEach(select => {
                        select.addEventListener('change', function() {
                            
                        });
                    });
                }
            });

            function toggleDropdownMenu(input) {
                // Hide all other dropdown menus
                document.querySelectorAll('.dropdown-menu').forEach(menu => menu.classList.remove('show'));

                const dropdownMenu = input.nextElementSibling;
                dropdownMenu.classList.toggle('show');
            }

            function filterDropdown(input) {
                const searchTerm = input.value.toLowerCase();
                const dropdownMenu = input.nextElementSibling;

                dropdownMenu.classList.add('show');

                Array.from(dropdownMenu.children).forEach(item => {
                    const itemName = item.textContent.toLowerCase();
                    item.style.display = itemName.includes(searchTerm) ? 'block' : 'none';
                });
            }

            function selectDropdownItem(item) {
                const searchInput =
                    item.closest('.target-item')?.querySelector('.dropdown-search') ||
                    item.closest('.reward')?.querySelector('.dropdown-search') ||
                    item.closest('.custom-dropdown')?.querySelector('.dropdown-search') ||
                    item.closest('.dropdown-menu')?.previousElementSibling;

                const dropdownMenu = item.closest('.dropdown-menu');

                if (searchInput && dropdownMenu) {
                    searchInput.value = item.textContent.trim();
                    searchInput.dataset.selectedValue = item.dataset.value;
                    dropdownMenu.classList.remove('show');
                } else {
                    console.error("Dropdown structure not found");
                }
            }

            function addCondition() {
                const container = document.getElementById('conditions-container');
                const conditionDiv = document.createElement('div');
                conditionDiv.classList.add("condition");
                const objLabel = generateUniqueId();

                conditionDiv.setAttribute('data-obj-label', objLabel);
                conditionDiv.innerHTML = `
                    <h4 class="objective-title" style="color: #06b600;">Objective - (Condition ID: ${objLabel})</h4>
                    <label style="color: #06b600;">Condition Type:
                        <select onchange="updateConditionFields(this)">
                            <option value="FindItem">Find Item</option>
                            <option value="HandoverItem">Handover Item</option>
                            <option value="Skill">Skill</option>
                            <option value="Equipment">Equipment</option>
                            <option value="VisitPlace">Visit Place</option>
                            <option value="Location">Location</option>
                            <option value="ExitStatus">Exit Status</option>
                            <option value="InZone">In Zone</option>
                            <option value="Kills">Kills</option>
                            <option value="LeaveItemAtLocation">Leave Item At Location</option>
                            <option value="PlaceBeacon">Place Beacon</option>
                            <option value="TraderLoyalty">Trader Loyalty</option>
                        </select>
                    </label>
                    <div class="condition-details"></div>
                    <div class="visibility-conditions">
                        <h4 style="color: #06b600;">Visibility Condition</h4>
                        <label>Condition ID to require completed:
                            <input type="text" class="visibility-target" placeholder="Enter Condition ID for hiding it until it's completed. (leave empty for none)">
                        </label>
                    </div>
                    <div style="margin-top: 10px; display: inline-block;">
                        <button class="remove-btn" onclick="removeCondition(this)" style="width: auto; padding: 10px 20px;">Remove Condition</button>
                    </div>
                `;
                container.appendChild(conditionDiv);
                addLanguageField(objLabel, `Objective`);
                updateConditionFields(conditionDiv.querySelector('select'));
            }

            function addLanguageField(fieldId, label) {
                const languageSection = document.getElementById('dynamic-lang-variables-container');
                
                const div = document.createElement('div');
                div.className = 'dynamic-lang-entry';
                div.innerHTML = `<label  style="color: #06b600;" for="${fieldId}">${label}:</label><input type="text" id="${fieldId}" placeholder="Enter text for ${label}, like 'Find HDD in raid'">`;
                languageSection.appendChild(div);
            }

            function removeCondition(button) {
                const conditionDiv = button.closest('.condition');
                const objLabel = conditionDiv.getAttribute('data-obj-label');

                document.getElementById(objLabel)?.parentElement.remove();
                conditionDiv.remove();

                adjustLanguageFields();
            }
            
            function adjustLanguageFields() {
                const languageSection = document.getElementById('dynamic-lang-variables-container');
                const conditions = document.querySelectorAll('#conditions-container > .condition');

                conditions.forEach(condition => {
                    const objLabel = condition.getAttribute('data-obj-label');

                    const existingInput = document.getElementById(objLabel);

                    if (!existingInput) {
                        addLanguageField(objLabel, `Objective`);
                    }
                });
            }

            async function updateConditionFields(selectElement) {
                if (!window.itemsLoaded) {
                    await loadItems();
                    if (!window.itemsLoaded) return;
                }

                const conditionDetails = selectElement.closest('.condition').querySelector('.condition-details');
                if (!conditionDetails) return;

                const skillOptions = [
                    "AdvancedModding", "AimDrills", "Assault", "Attention", "Barter", "Charisma", 
                    "CovertMovement", "Crafting", "DMR", "Endurance", "FirstAid", "Health", "HeavyVests", 
                    "HideoutManagement", "HMG", "Immunity", "Intellect", "LightVests", "LMG",
                    "MagDrills", "Melee", "Memory", "Metabolism", "Perception", "Pistol", "ProneMovement",
                    "RecoilControl", "Revolver", "Search",
                    "Shotgun", "SMG", "Sniper", "Sniping", "Strength", "StressResistance",
                    "Surgery", "Throwables", "Troubleshooting",
                    "Troubleshooting", "Vitality", "WeaponModding"
                ];

                // FindItem and HandoverItem conditions
                if (selectElement.value === 'FindItem' || selectElement.value === 'HandoverItem') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Target Items:</label>
                        <div class="target-items-container"></div>
                        <button type="button" onclick="addTargetItem()" style="margin-top: 10px; width: auto;">Add New Item</button>
                        <label style="color: #06b600;">Value:
                            <input type="number" placeholder="Enter level" required value="1">
                        </label>
                        <div style="display: flex; align-items: center; text-align: left;">
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" style="margin-right: 5px;"> Only Found In Raid
                            </label>
                        </div>
                    `;
                } 
                // Kill condition
                else if (selectElement.value === 'Kills') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Target:
                            <select id="target-select" required>
                                <option value="Savage">Scavs</option>
                                <option value="AnyPmc">PMCs</option>
                                <option value="Usec">Usec</option>
                                <option value="Bear">Bear</option>
                                <option value="Any" selected>Any</option>
                            </select>
                        </label>
                        <label id="savage-role-label" style="display:none; color: #06b600;">Savage Role (select multiple with ctrl + click):</label>
                        <select id="savage-role-select" style="display:none;" multiple>
                            <option value="">Any</option>
                            <option value="bossKilla">Killa</option>
                            <option value="bossTagilla">Tagilla</option>
                            <option value="bossBully">Reshala</option>
                            <option value="followerBully">Reshala's Bodyguards</option>
                            <option value="bossKojaniy">Schturman</option>
                            <option value="bossGluhar">Gluhar</option>
                            <option value="followerGluharAssault">Gluhar Guard Assault</option>
                            <option value="followerGluharScout">Gluhar Guard Scout</option>
                            <option value="followerGluharSecurity">Gluhar Guard Security</option>
                            <option value="followerGluharSnipe">Gluhar Guard Sniper</option>
                            <option value="pmcBot">Raider</option>
                            <option value="bossSanitar">Sanitar</option>
                            <option value="followerSanitar">Sanitar Bodyguards</option>
                            <option value="bossKnight">Knight</option>
                            <option value="followerBigPipe">BigPipe</option>
                            <option value="followerBirdEye">BirdEye</option>
                            <option value="exUsec">Rogue</option>
                            <option value="marksman">Sniper Scavs</option>
                            <option value="sectantPriest">Cultist Priest</option>
                            <option value="sectantWarrior">Cultist Warrior</option>
                            <option value="arenaFighterEvent">Bloodhound</option>
                        </select>
                        <label style="color: #06b600;">Kills Required:
                            <input type="number" placeholder="Number of kills" required value="1">
                        </label>
                        <label style="color: #06b600;">Distance: (0 = any distance, >= 50 = greater than or equal to 50m)
                            <select class="equalto">
                                <option value=">=">&ge;</option>
                                <option value="<=">&le;</option>
                            </select>
                            <input class="small-number" type="number" placeholder="Distance in meters" required value="0">
                        </label>
                        <label style="color: #06b600;">Time of Day From (0-24):
                            <input id="time-from-input" class="small-number" type="number" min="0" max="24" value="0" required>
                        </label>
                        <label style="color: #06b600;">Time of Day To (0-24):
                            <input id="time-to-input" class="small-number" type="number" min="0" max="24" value="0" required>
                        </label>
                        <label style="color: #06b600;">Select Weapon Caliber (select multiple with ctrl + click):</label>
                        <div class="weapon-caliber-container">
                            <select multiple id="weapon-caliber-select" class="weapon-caliber-dropdown" onchange="handleWeaponCaliberSelection()">
                                <option value="all">All</option>
                                <option value="543be6564bdc2df4348b4568">Throwable</option>
                                <option value="5447e1d04bdc2dff2f8b4567">Melee Weapons</option>
                                <option value="5447bed64bdc2d97278b4568">Machine Guns</option>
                                <option value="5447b6254bdc2dc3278b4568">Sniper Rifles</option>
                                <option value="5447b5e04bdc2d62278b4567">SMGs</option>
                                <option value="5447b6094bdc2dc3278b4567">Shotguns</option>
                                <option value="5447b5cf4bdc2d65278b4567">Pistol</option>
                                <option value="5447b6194bdc2d67278b4567">Marksman Rifles</option>
                                <option value="5447b5f14bdc2d61278b4567">Assault Rifles</option>
                                <option value="5447b5fc4bdc2d87278b4567">Assault Carbines</option>
                            </select>
                        </div>
                        <label style="color: #06b600;">Target Body Part (select multiple with ctrl + click):</label>
                        <select id="body-part-select" multiple>
                            <option value="">Any</option>
                            <option value="Head">Head</option>
                            <option value="Chest">Chest</option>
                            <option value="Stomach">Stomach</option>
                            <option value="LeftArm">Left Arm</option>
                            <option value="RightArm">Right Arm</option>
                            <option value="LeftLeg">Left Leg</option>
                            <option value="RightLeg">Right Leg</option>
                        </select>
                        <label style="color: #06b600;">Weapons Mods to Include:</label>
                        <div id="weapon-mods-inclusive-container">
                            <button type="button" onclick="addWeaponModInclusive()">Add Weapon Mod to Include</button>
                            <div id="weapon-items-container" class="weapon-mods-inclusive"></div>
                        </div>

                        <label style="color: #06b600;">Weapons Mods to Exclude:</label>
                        <div id="weapon-mods-exclusive-container">
                            <button type="button" onclick="addWeaponModExclusive()">Add Weapon Mod to Exclude</button>
                            <div id="weapon-items-container" class="weapon-mods-exclusive"></div>
                        </div>
                        
                        <label style="color: #06b600;">Items Required to be Equipped:</label>
                        <div id="kills-equipment-inclusive-container">
                            <button type="button" onclick="addInclusiveEquipmentItem()">Add Equipment to Include</button>
                            <div id="equipment-items-container" class="inclusive-equipment-items-container"></div>
                        </div>
                        
                        <label style="color: #06b600;">Items Required to NOT be Equipped:</label>
                        <div id="kills-equipment-exclusive-container">
                            <button type="button" onclick="addExclusiveEquipmentItem()">Add Equipment to Exclude</button>
                            <div id="equipment-items-container" class="exclusive-equipment-items-container"></div>
                        </div>

                        <div style="display: flex; align-items: center; text-align: left;">
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" style="margin-right: 5px;">
                                Reset on Session End
                            </label>
                        </div>
                        <div id="subcondition-list-container" style="margin-top: 20px;">
                            <h4 style="color: #06b600;">Subconditions:</h4>
                        </div>
                        <button type="button" id="add-subcondition-btn" style="margin-top: 10px;">Add Subcondition</button>
                    `;
                    
                    const subconditionListContainer = conditionDetails.querySelector('#subcondition-list-container');
                    const addSubconditionBtn = conditionDetails.querySelector('#add-subcondition-btn');

                    const targetSelect = document.getElementById('target-select');
                        if (targetSelect) {
                            targetSelect.addEventListener('change', function() {
                                const savageRoleLabel = document.getElementById('savage-role-label');
                                const savageRoleSelect = document.getElementById('savage-role-select');
                                if (this.value === 'Savage') {
                                    savageRoleLabel.style.display = 'block';
                                    savageRoleSelect.style.display = 'block';
                                } else {
                                    savageRoleLabel.style.display = 'none';
                                    savageRoleSelect.style.display = 'none';
                                }
                            });
                        }

                        addSubconditionBtn.addEventListener('click', function () {
                            const subconditionId = generateUniqueId();
                            const subconditionElement = document.createElement('div');
                            subconditionElement.classList.add('subcondition');
                            subconditionElement.dataset.subconditionId = subconditionId;
                            subconditionElement.innerHTML = `
                                <div style="border: 1px solid #06b600; padding: 10px; margin-top: 10px;">
                                    <label style="color: #06b600;">Subcondition Type:
                                        <select class="subcondition-type">
                                            <option value="" selected>Select</option>
                                            <option value="InZone">In Zone</option>
                                            <option value="Location">Location</option>
                                        </select>
                                    </label>
                                    <div class="subcondition-details" style="margin-top: 10px;"></div>
                                    <button type="button" class="remove-subcondition-btn" style="margin-top: 10px;">Remove</button>
                                </div>
                            `;

                            // Add event listener for subcondition type selection
                            const subconditionTypeSelect = subconditionElement.querySelector('.subcondition-type');
                            const subconditionDetails = subconditionElement.querySelector('.subcondition-details');
                            subconditionTypeSelect.addEventListener('change', function () {
                                if (this.value === 'InZone') {
                                    subconditionDetails.innerHTML = `
                                        <label style="color: #06b600;">Zone IDs (comma-separated):
                                            <input type="text" class="zoneid-inzone" placeholder="Enter zone IDs" required>
                                        </label>
                                    `;
                                } else if (this.value === 'Location') {
                                    subconditionDetails.innerHTML = `
                                        <label style="color: #06b600;">Location (select multiple with ctrl + click):</label>
                                        <select multiple class="location-dropdown">
                                            <option value="Interchange">Interchange</option>
                                            <option value="factory4_day">Factory Day</option>
                                            <option value="factory4_night">Factory Night</option>
                                            <option value="bigmap">Customs</option>
                                            <option value="Woods">Woods</option>
                                            <option value="Lighthouse">Lighthouse</option>
                                            <option value="Shoreline">Shoreline</option>
                                            <option value="RezervBase">Reserve</option>
                                            <option value="laboratory">The Lab</option>
                                            <option value="TarkovStreets">Streets</option>
                                            <option value="Sandbox">Ground Zero (PMC < 20)</option>
                                            <option value="Sandbox_high">Ground Zero (PMC > 20)</option>
                                        </select>
                                    `;
                                } else {
                                    subconditionDetails.innerHTML = '';
                                }
                            });

                            // Add event listener for removing the subcondition
                            const removeSubconditionBtn = subconditionElement.querySelector('.remove-subcondition-btn');
                            removeSubconditionBtn.addEventListener('click', function () {
                                subconditionElement.remove();
                            });

                            subconditionListContainer.appendChild(subconditionElement);
                        });
                } 
                // VisitPlace condition
                else if (selectElement.value === 'VisitPlace') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Target Zone ID (e.g., huntsman_029):
                            <input type="text" class="visit-place-target" placeholder="Enter zone ID" required>
                        </label>
                        <div style="display: flex; align-items: center; text-align: left;">
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" class="visit-place-one-session-only" style="margin-right: 5px;">
                                One Session Only
                            </label>
                        </div>
                    `;
                } 
                // Skill condition
                else if (selectElement.value === 'Skill') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Compare Method:
                            <select>
                                <option value=">=" selected>&ge;</option>
                                <option value="<=">&le;</option>
                            </select>
                        </label>
                        <label style="color: #06b600;">Skill Type:
                            <select class="skill-target">
                                ${skillOptions.map(skill => `<option value="${skill}">${skill}</option>`).join('')}
                            </select>
                        </label>
                        <label style="color: #06b600;">Required Skill Level: (1 = 1 level, 2 = 2 levels, etc.)
                            <input type="number" class="skill-value" placeholder="Enter skill level" required>
                        </label>
                    `;
                } 
                // Equipment condition
                else if (selectElement.value === 'Equipment') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Items Required to be Equipped:</label>
                        <div id="equipment-inclusive-container">
                            <button type="button" onclick="addInclusiveItem()">Add Equipment to Include</button>
                            <div class="inclusive-items-container"></div>
                        </div>
                        
                        <label style="color: #06b600;">Items Required to NOT be Equipped</label>
                        <div id="equipment-exclusive-container">
                            <button type="button" onclick="addExclusiveItem()">Add Equipment to Exclude</button>
                            <div class="exclusive-items-container"></div>
                        </div>
                        
                    `;
                } // Location condition 
                // Location condition
                else if (selectElement.value === 'Location') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Location (select multiple with ctrl + click):</label>
                        <select multiple class="location-dropdown">
                            <option value="Interchange">Interchange</option>
                            <option value="factory4_day">Factory Day</option>
                            <option value="factory4_night">Factory Night</option>
                            <option value="bigmap">Customs</option>
                            <option value="Woods">Woods</option>
                            <option value="Lighthouse">Lighthouse</option>
                            <option value="Shoreline">Shoreline</option>
                            <option value="RezervBase">Reserve</option>
                            <option value="laboratory">The Lab</option>
                            <option value="TarkovStreets">Streets</option>
                            <option value="Sandbox">Ground Zero (PMC < 20)</option>
                            <option value="Sandbox_high">Ground Zero (PMC > 20)</option>
                        </select>
                    `;
                }
                // ExitStatus condition
                else if (selectElement.value === 'ExitStatus') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Exit Status (select multiple with ctrl + click):</label>
                        <select multiple class="exit-status-dropdown">
                            <option value="Survived">Survived</option>
                            <option value="Runner">Runner</option>
                            <option value="Killed">Killed</option>
                            <option value="Left">Left</option>
                            <option value="MissingInAction">Missing In Action</option>
                        </select>
                        <label style="display: block; margin-top: 10px;">
                            <input type="checkbox" id="doNotResetIfCounterCompleted">
                            Do Not Reset If Counter Completed
                        </label>
                        <label style="display: block; margin-top: 10px;">
                            Value: <input type="number" id="counter-value" value="1" min="0" style="width: 50px;">
                        </label>
                        <div id="subcondition-list-container" style="margin-top: 20px;">
                            <h4 style="color: #06b600;">Subconditions:</h4>
                        </div>
                        <button type="button" id="add-subcondition-btn" style="margin-top: 10px;">Add Subcondition</button>
                    `;

                    const subconditionListContainer = conditionDetails.querySelector('#subcondition-list-container');
                    const addSubconditionBtn = conditionDetails.querySelector('#add-subcondition-btn');

                    addSubconditionBtn.addEventListener('click', function () {
                        const subconditionId = generateUniqueId();
                        const subconditionElement = document.createElement('div');
                        subconditionElement.classList.add('subcondition');
                        subconditionElement.dataset.subconditionId = subconditionId;

                        subconditionElement.innerHTML = `
                            <div style="border: 1px solid #06b600; padding: 10px; margin-top: 10px;">
                                <label style="color: #06b600;">Subcondition Type:
                                    <select class="subcondition-type">
                                        <option value="" selected>Select</option>
                                        <option value="Location">Location</option>
                                        <option value="Exfil">Exit Name</option>
                                    </select>
                                </label>
                                <div class="subcondition-details" style="margin-top: 10px;"></div>
                                <button type="button" class="remove-subcondition-btn" style="margin-top: 10px;">Remove</button>
                            </div>
                        `;

                        const subconditionTypeSelect = subconditionElement.querySelector('.subcondition-type');
                        const subconditionDetails = subconditionElement.querySelector('.subcondition-details');

                        subconditionTypeSelect.addEventListener('change', function () {
                            if (this.value === 'Location') {
                                subconditionDetails.innerHTML = `
                                    <label style="color: #06b600;">Location (select multiple with ctrl + click):</label>
                                    <select multiple class="location-dropdown">
                                        <option value="Interchange">Interchange</option>
                                        <option value="factory4_day">Factory Day</option>
                                        <option value="factory4_night">Factory Night</option>
                                        <option value="bigmap">Customs</option>
                                        <option value="Woods">Woods</option>
                                        <option value="Lighthouse">Lighthouse</option>
                                        <option value="Shoreline">Shoreline</option>
                                        <option value="RezervBase">Reserve</option>
                                        <option value="laboratory">The Lab</option>
                                        <option value="TarkovStreets">Streets</option>
                                    </select>
                                `;
                            } else if (this.value === 'Exfil') {
                                subconditionDetails.innerHTML = `
                                    <label style="color: #06b600;">Select Role:</label>
                                    <select class="role-select" onchange="populateExfilDropdown(this)">
                                        <option value="PMC">PMC</option>
                                        <option value="Scav">Scav</option>
                                    </select>
                                    <label style="color: #06b600;">Select Map:</label>
                                    <select class="map-select" onchange="populateExfilDropdown(this)">
                                        <option value="Streets">Streets</option>
                                        <option value="Customs">Customs</option>
                                        <option value="Woods">Woods</option>
                                        <option value="Reserve">Reserve</option>
                                        <option value="Interchange">Interchange</option>
                                        <option value="Lighthouse">Lighthouse</option>
                                        <option value="Shoreline">Shoreline</option>
                                        <option value="Factory">Factory</option>
                                    </select>
                                    <label style="color: #06b600;">Exfil Points:</label>
                                    <select class="exfil-dropdown"></select>
                                    <label style="color: #06b600;">Custom Exfil:</label>
                                    <input type="text" class="custom-exfil" placeholder="Enter custom exfil point">
                                `;

                                const roleSelect = subconditionDetails.querySelector('.role-select');
                                const mapSelect = subconditionDetails.querySelector('.map-select');
                                const exfilDropdown = subconditionDetails.querySelector('.exfil-dropdown');

                                const locations = {
                                    PMC: {
                                        Streets: {
                                            E1: "Stylobate Building Elevator",
                                            E2: "Sewer River",
                                            E3: "Damaged House",
                                            E4: "Crash Site",
                                            E5: "Collapsed Crane",
                                            E6: "Scav Checkpoint",
                                            E7: "Expo Checkpoint",
                                            E7_car: "Primorsky Ave Taxi V-Ex",
                                            E8: "Cardinal Apartment Complex",
                                            E8_yard: "Courtyard",
                                            E9_sniper: "Klimov Street",
                                            Exit_E10_coop: "Pinewood Basement (Co-Op)",
                                        },
                                        Customs: {
                                            Crossroads: "Crossroads",
                                            "RUAF Roadblock": "RUAF Roadblock",
                                            "Dorms V-Ex": "Dorms V-Ex",
                                            "Old Gas Station": "Old Gas Station",
                                            "Smuggler's Boat": "Smuggler's Boat",
                                            "Trailer Park": "Trailer Park",
                                            EXFIL_ZB013: "ZB-013",
                                            "ZB-1011": "ZB-1011",
                                            "ZB-1012": "ZB-1012",
                                        },
                                        Woods: {
                                            Outskirts: "Outskirts",
                                            "UN Roadblock": "UN Roadblock",
                                            "South V-Ex": "Bridge V-Ex",
                                            "un-sec": "Northern UN Roadblock",
                                            "RUAF Gate": "RUAF Gate",
                                            "ZB-014": "ZB-014",
                                            "ZB-016": "ZB-016",
                                        },
                                        Reserve: {
                                            EXFIL_Train: "Armored Train",
                                            EXFIL_Bunker: "Bunker Hermetic Door",
                                            Alpinist: "Cliff Descent",
                                            EXFIL_BUNKER_D2: "D-2",
                                            EXFIL_vent: "Sewer Manhole",
                                            EXFIL_ScavCooperation: "Scav Lands (Co-Op)",
                                        },
                                        Interchange: {
                                            "SE Exfil": "Emercom Checkpoint",
                                            "NW Exfil": "Railway Exfil",
                                            "Hole Exfill": "Hole in the Fence",
                                            "PP Exfil": "Power Station V-Ex",
                                            "Saferoom Exfil": "Saferoom Exfil",
                                            "Interchange Cooperation": "Scav Camp (Co-Op)",
                                        },
                                        Lighthouse: {
                                            EXFIL_Train: "Armored Train",
                                            SCAV_FREE4ALL: "Path to Shoreline",
                                            Alpinist_light: "Mountain Pass",
                                            Nothern_Checkpoint: "Northern Checkpoint",
                                            "V-ex_light": "Road to Military Base V-Ex",
                                            Coastal_South_road: "Southern Road",
                                            Tunnel_Shared: "Side Tunnel (Co-Op)",
                                        },
                                        Shoreline: {
                                            "Road to Customs": "Road to Customs",
                                            RedRebel_alp: "Climber's Trail",
                                            Lighthouse_pass: "Path to Lighthouse",
                                            "Pier Boat": "Pier Boat",
                                            ROAD_AT_RAILBRIDGE: "Railway Bridge",
                                            Shorl_V_Ex: "Road to North V-Ex",
                                            Tunnel: "Tunnel",
                                            Smugglers_Trail_coop: "Smuggler's Path (Co-op)",
                                        },
                                        Factory: {
                                            "Gate 3": "Gate 3",
                                            Cellars: "Cellars",
                                            "Gate 0": "Gate 0",
                                            Gate_m: "Med Tent Gate",
                                        },
                                    },
                                    Scav: {
                                        Streets: {
                                            scav_e1: "Basement Descent",
                                            scav_e2: "Entrance to Catacombs",
                                            scav_e3: "Ventilation Shaft",
                                            scav_e4: "Sewer Manhole",
                                            scav_e5: "Near Kamchatskaya Arch",
                                            scav_e6: "Basement Entrance",
                                            scav_e7: "Cardinal Apartment Complex Parking",
                                            scav_e8: "Klimov Shopping Mall Exfil",
                                        },
                                        Customs: {
                                            "Administration Gate": "Administration Gate",
                                            "Factory Far Corner": "Factory Far Corner",
                                            "Factory Shacks": "Factory Shacks",
                                            Shack: "Military Base CP",
                                            "Old Azs Gate": "Old Gas Station Gate",
                                            "Old Road Gate": "Old Road Gate",
                                            "Beyond Fuel Tank": "Passage Between Rocks",
                                            "Railroad To Military Base": "Railroad to Military Base",
                                            "Railroad To Port": "Railroad to Port",
                                            "Railroad To Tarkov": "Railroad to Tarkov",
                                            "Sniper Roadblock": "Sniper Roadblock",
                                            "Trailer Park Workers Shack": "Trailer Park Workers' Shack",
                                            "Warehouse 17": "Warehouse 17",
                                            "Warehouse 4": "Warehouse 4",
                                        },
                                        Woods: {
                                            "Dead Man's Place": "Dead Man's Place",
                                            "West Border": "Eastern Rocks",
                                            "Mountain Stash": "Mountain Stash",
                                            "Old Station": "Old Railway Depot",
                                            RUAF_Roadblock_scav: "RUAF Roadblock",
                                            "Outskirts Water": "Scav Bridge",
                                            "East Gate": "Scav Bunker",
                                            "Scav House": "Scav House",
                                        },
                                        Reserve: {
                                            Exit1: "Hole in the Wall by the Mountains",
                                            Exit2: "Heating Pipe",
                                            Exit3: "Depot Hermetic Door",
                                            Exit4: "Checkpoint Fence",
                                        },
                                        Lighthouse: {
                                            SCAV_Underboat_Hideout: "Hideout Under the Landing Stage",
                                            SCAV_Industrial_Zone: "Industrial Zone Gates",
                                            Scav_Hideout_at_the_grotto: "Scav Hideout at the Grotto",
                                            Scav_Coastal_South: "Southern Road Landslide",
                                        },
                                        Shoreline: {
                                            "Adm Basement": "Admin Basement",
                                            "RWing Gym Entrance": "East Wing Gym Entrance",
                                            Lighthouse: "Lighthouse",
                                            "South Fence Passage": "Old Bunker",
                                            "Wrecked Road": "Ruined Road",
                                        },
                                        Factory: {
                                            "Camera Bunker Door": "Camera Bunker Door",
                                            "Office Window": "Office Window",
                                        },
                                    }
                                };

                                function populateExfilDropdown() {
                                    const role = roleSelect.value;
                                    const map = mapSelect.value;

                                    exfilDropdown.innerHTML = '';
                                    if (locations[role] && locations[role][map]) {
                                        Object.entries(locations[role][map]).forEach(([key, value]) => {
                                            const option = document.createElement('option');
                                            option.value = key;
                                            option.textContent = value;
                                            exfilDropdown.appendChild(option);
                                        });
                                    }
                                }

                                roleSelect.addEventListener('change', populateExfilDropdown);
                                mapSelect.addEventListener('change', populateExfilDropdown);

                                // Initial population
                                populateExfilDropdown();
                            }
                            else {
                                subconditionDetails.innerHTML = '';
                            }
                        });

                        const removeSubconditionBtn = subconditionElement.querySelector('.remove-subcondition-btn');
                        removeSubconditionBtn.addEventListener('click', function () {
                            subconditionElement.remove();
                        });

                        subconditionListContainer.appendChild(subconditionElement);
                    });
                }
                // InZone condition
                else if (selectElement.value === 'InZone') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Zone IDs (e.g., Woods_Sawmill, Woods_Old_Sawmill):
                            <input class="zoneid-inzone" type="text" placeholder="Enter zone IDs, separated by commas" required>
                        </label>
                    `;
                }
                // LeaveItemAtLocation condition
                else if (selectElement.value === 'LeaveItemAtLocation') {
                    conditionDetails.innerHTML = `
                        <div class="condition">
                            <label style="color: #06b600;">Target Zone ID:
                                <input type="text" placeholder="Enter zone ID (e.g., Saving_The_Mole)" required>
                            </label>
                            <label style="color: #06b600;">Plant Time:
                                <input class="small-number" type="number" placeholder="Enter plant time in seconds" value="10"  required>
                            </label>
                            <label style="color: #06b600;">Value:
                                <input class="small-number" type="number" placeholder="Enter quantity of item to plant" value="1" required>
                            </label>
                            <label style="color: #06b600;">Min Durability:
                                <input class="small-number" type="number" placeholder="Enter minimum item durability" value="0" required>
                            </label>
                            <label style="color: #06b600;">Max Durability:
                                <input class="small-number" type="number" placeholder="Enter maximum item durability" value="100" required>
                            </label>
                            <label style="color: #06b600;">Dogtag Level: (leave 0 if not required)
                                <input class="small-number" type="number" placeholder="Enter required dogtag level" value="0" required>
                            </label>
                            <label style="color: #06b600;">Only Found In Raid:
                                <input type="checkbox">
                            </label>
                            <label style="color: #06b600;">Item IDs to Plant:</label>
                            <button type="button" onclick="addTargetItem()" style="margin-top: 10px;">Add Item</button>
                            <div class="target-items-container"></div>
                        </div>
                    `;
                }
                // PlaceBeacon condition
                else if (selectElement.value === 'PlaceBeacon') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Search or Enter ID:</label>
                        <input type="text" class="dropdown-search" placeholder="Search items or enter ID..."
                            oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                        <div class="dropdown-menu">
                            ${items.map(item => `
                                <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                    ${item.displayName}
                                </div>
                            `).join('')}
                        </div>
                        <label style="color: #06b600;">Zone ID:
                            <input type="text" class="place-beacon-zoneid" placeholder="Enter zone ID" required>
                        </label>
                        <label style="color: #06b600;">Plant Time (seconds):
                            <input type="number" class="place-beacon-planttime" placeholder="Enter plant time" required value="30">
                        </label>
                        <label style="color: #06b600;">Value:
                            <input type="number" class="place-beacon-value" placeholder="Number to place" required value="1">
                        </label>
                    `;
                } else if (selectElement.value === 'TraderLoyalty') {
                    conditionDetails.innerHTML = `
                        <label style="color: #06b600;">Trader ID:
                            <input type="text" placeholder="Enter trader ID" required>
                        </label>
                        <label style="color: #06b600;">Loyalty Level:</label>
                        <label style="color: #06b600;">Loyalty Level:
                            <select class="loyalty-level-condition">
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </label>
                        <label style="color: #06b600;">Compare Method:</label>
                        <select class="compare-method-select">
                            <option value=">=" selected>&ge;</option>
                            <option value="<=">&le;</option>
                        </select>
                    `;
                }
            }

            function addTargetItem() {
                const container = document.querySelector('.target-items-container');
                const targetDiv = document.createElement('div');
                targetDiv.classList.add('target-item');

                targetDiv.innerHTML = `
                    <label style="color: #06b600;">Search or Enter ID:</label>
                    <input type="text" class="dropdown-search" placeholder="Search items or enter ID..."
                        oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeTargetItem(this)" style="margin-top: 10px;">Remove</button>
                `;
                container.appendChild(targetDiv);
            }

            function removeTargetItem(button) {
                button.closest('.target-item').remove();
            }
            
            function removeItem(button) {
                button.closest('.item-to-plant').remove();
            }

            function addWeaponModInclusive() {
                const container = document.querySelector('.weapon-mods-inclusive');
                const modDiv = document.createElement('div');
                modDiv.classList.add('weapon-mod-item');

                modDiv.innerHTML = `
                    <label style="color: #06b600;">Search or Enter Mod ID:</label>
                    <input type="text" class="dropdown-search" placeholder="Search mods or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeWeaponMod(this)" style="margin-top: 10px;">Remove</button>
                `;

                container.appendChild(modDiv);
            }

            function addWeaponModExclusive() {
                const container = document.querySelector('.weapon-mods-exclusive');
                const modDiv = document.createElement('div');
                modDiv.classList.add('weapon-mod-item');

                modDiv.innerHTML = `
                    <label style="color: #06b600;">Search or Enter Mod ID:</label>
                    <input type="text" class="dropdown-search" placeholder="Search mods or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeWeaponMod(this)" style="margin-top: 10px;">Remove</button>
                `;

                container.appendChild(modDiv);
            }

            function removeWeaponMod(button) {
                button.closest('.weapon-mod-item').remove();
            }

            function addEquipmentItem() {
                const container = document.querySelector('.equipment-inclusive-container');
                const equipmentDiv = document.createElement('div');
                equipmentDiv.classList.add('equipment-item');

                equipmentDiv.innerHTML = `
                    <label style="color: #06b600;">Search or Enter ID:</label>
                    <input type="text" class="dropdown-search" placeholder="Search items or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeEquipmentItem(this)" style="margin-top: 10px;">Remove</button>
                `;

                container.appendChild(equipmentDiv);
            }

            function addInclusiveEquipmentItem() {
                const container = document.querySelector('.inclusive-equipment-items-container');
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('equipment-item');

                itemDiv.innerHTML = `
                    <label style="color: #06b600;">Search or Enter ID:</label>
                    <input type="text" class="dropdown-search" placeholder="Search items or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeEquipmentItem(this)" style="margin-top: 10px;">Remove</button>
                `;

                container.appendChild(itemDiv);
            }

            function addExclusiveEquipmentItem() {
                const container = document.querySelector('.exclusive-equipment-items-container');
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('equipment-item');

                itemDiv.innerHTML = `
                    <label style="color: #06b600;">Search or Enter ID:</label>
                    <input type="text" class="dropdown-search" placeholder="Search items or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeEquipmentItem(this)" style="margin-top: 10px;">Remove</button>
                `;

                container.appendChild(itemDiv);
            }

            function removeEquipmentItem(button) {
                button.closest('.equipment-item').remove();
            }

            function addInclusiveItem() {
                const container = document.querySelector('.inclusive-items-container');
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('inclusive-item');

                itemDiv.innerHTML = `
                    <label style="color: #06b600;">Inclusive Item ID:</label>
                    <input type="text" class="dropdown-search inclusive-item-id" placeholder="Search items or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeItem(this)" style="margin-top: 10px;">Remove</button>
                `;


                container.appendChild(itemDiv);
                }

            function addExclusiveItem() {
                const container = document.querySelector('.exclusive-items-container');
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('exclusive-item');
                
                itemDiv.innerHTML = `
                    <label style="color: #06b600;">Exclusive Item ID:</label>
                    <input type="text" class="dropdown-search exclusive-item-id" placeholder="Search items or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeItem(this)" style="margin-top: 10px;">Remove</button>
                `;


                container.appendChild(itemDiv);
            }

            function removeItem(button) {
                button.closest('.inclusive-item, .exclusive-item').remove();
            }

            function handleWeaponCaliberSelection() {
                const weaponCaliberSelect = document.getElementById('weapon-caliber-select');
                const isAllSelected = Array.from(weaponCaliberSelect.selectedOptions).some(option => option.value === 'all');

                if (isAllSelected) {
                    Array.from(weaponCaliberSelect.options).forEach(option => {
                        option.selected = option.value === 'all';
                    });
                    selectedWeaponCalibers = ["all"];
                } else {
                    selectedWeaponCalibers = Array.from(weaponCaliberSelect.selectedOptions).map(option => option.value);
                }
            }

            function addTargetItem() {
                const conditionDiv = event.target.closest('.condition');
                const container = conditionDiv.querySelector('.target-items-container');
                const targetDiv = document.createElement('div');
                targetDiv.classList.add('target-item');

                targetDiv.innerHTML = `
                    <label style="color: #06b600;">Search or Enter ID:</label>
                    <input type="text" class="dropdown-search" placeholder="Search items or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeTargetItem(this)" style="margin-top: 10px;">Remove</button>
                `;


                container.appendChild(targetDiv);
            }

            function removeTargetItem(button) {
                button.closest('.target-item').remove();
            }

            function addTargetItemFail(container = null) {
                container = container || document.querySelector('.target-items-fail-container');
                if (!container) {
                    console.error("No container found for target items.");
                    return;
                }

                const targetDiv = document.createElement('div');
                targetDiv.classList.add('target-item-fail');

                targetDiv.innerHTML = `
                    <input type="text" class="dropdown-search-fail" placeholder="Search items or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                    <div class="dropdown-menu">
                        ${items.map(item => `
                            <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                ${item.displayName}
                            </div>
                        `).join('')}
                    </div>
                    <button type="button" onclick="removeTargetItemFail(this)" style="margin-top: 10px;">Remove</button>
                `;

                container.appendChild(targetDiv);
            }

            function removeTargetItemFail(button) {
                button.closest('.target-item-fail').remove();
            }

            function getTplId(inputElement) {
                return inputElement.dataset.selectedValue || inputElement.value;
            }

            function handleSPTVersionChange() {
                const version = document.getElementById('spt-version').value;
                const rewardEditionSections = document.querySelectorAll('.reward-editions');

                rewardEditionSections.forEach(section => {
                    section.style.display = version === '3.10' ? 'block' : 'none';
                });
            }

            function addStartedReward() {
                const container = document.getElementById('started-rewards-container');
                const rewardDiv = document.createElement('div');
                rewardDiv.classList.add("started-reward");

                rewardDiv.innerHTML = `
                    <section id="quest-start-rewards-container">
                        <label style="color: #06b600;">Item ID:</label>
                        <div class="custom-dropdown">
                            <input type="text" class="dropdown-search" placeholder="Search items or enter ID..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                            <div class="dropdown-menu">
                                ${items.map(item => `
                                    <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                        ${item.displayName}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <label style="color: #06b600;">Quantity:
                            <input type="number" class="stack-count" value="1" min="1">
                        </label>
                        <div class="reward-editions" style="display: none;">
                            <label for="available-editions">Available for Profile Editions:</label>
                            <select class="available-editions" multiple>
                                <option value="standard">Standard</option>
                                <option value="left_behind">Left Behind</option>
                                <option value="edge_of_darkness">Edge of Darkness</option>
                                <option value="prepare_for_escape">Prepare for Escape</option>
                                <option value="exhibition">Exhibition</option>
                                <option value="press_edition">Press Edition</option>
                                <option value="tournament_live">Tournament Live</option>
                                <option value="tournament">Tournament</option>
                                <option value="develop">Develop</option>
                            </select>
                            <input type="text" class="custom-edition" placeholder="Enter custom edition">
                        </div>
                        <button onclick="removeStartedReward(this)" style="margin-top: 10px; width: auto;">Remove Reward</button>
                    </section>
                `;


                container.appendChild(rewardDiv);
                handleSPTVersionChange();
            }

            function removeStartedReward(button) {
                button.closest('.started-reward').remove();
            }

            function generateStartedRewards() {
                const rewards = Array.from(document.querySelectorAll('#started-rewards-container .started-reward')).map((rewardDiv, index) => {
                    const version = document.getElementById('spt-version').value;
                    const inputElement = rewardDiv.querySelector('.dropdown-search');
                    const tplId = getTplId(inputElement);
                    const stackCount = parseInt(rewardDiv.querySelector('.stack-count').value, 10);
                    const questNumber = document.getElementById('quest-number').value || '0';
                    const uniqueId = generateUniqueId();
                    const traderId = document.getElementById('trader-name').value || 'trader';
                    const rewardId = generateUniqueId();

                    let availableInGameEditions = [];

                    const reward = {
                        findInRaid: true,
                        id: rewardId,
                        index: index,
                        items: [
                            {
                                _id: uniqueId,
                                _tpl: tplId,
                                upd: {
                                    StackObjectsCount: stackCount
                                }
                            }
                        ],
                        target: uniqueId,
                        type: "Item",
                        value: "1"
                    };

                    if (version === '3.10') {
                        const selectedOptions = Array.from(rewardDiv.querySelector('.available-editions')?.selectedOptions || [])
                            .map(option => option.value);
                        const customEdition = rewardDiv.querySelector('.custom-edition')?.value.trim();
                        if (customEdition) {
                            selectedOptions.push(customEdition);
                        }
                        reward.availableInGameEditions = selectedOptions.length > 0 ? selectedOptions : [];
                    }

                    return reward;
                });

                return rewards;
            }

            function addReward() {
                const container = document.getElementById('rewards-container');
                const rewardDiv = document.createElement('div');
                rewardDiv.classList.add("reward");

                rewardDiv.innerHTML = `
                    <label style="color: #06b600;">Reward Type:
                        <select onchange="updateRewardFields(this)">
                            <option value="Experience">Experience</option>
                            <option value="TraderStanding">Trader Standing</option>
                            <option value="Item">Item</option>
                            <option value="AssortmentUnlock">AssortmentUnlock</option>
                            <option value="Skill">Skill</option>
                        </select>
                    </label>
                    <div class="reward-details"></div>
                    <button onclick="removeReward(this)" style="margin-top: 10px; width: auto;">Remove Reward</button>
                `;
                
                container.appendChild(rewardDiv);
                updateRewardFields(rewardDiv.querySelector('select'));
                handleSPTVersionChange();
            }

            function updateRewardFields(selectElement) {
                const rewardDetails = selectElement.closest('.reward').querySelector('.reward-details');
                rewardDetails.innerHTML = '';
                const skillOptions = [
                    "AdvancedModding", "AimDrills", "Assault", "Attention", "Barter", "Charisma", 
                    "CovertMovement", "Crafting", "DMR", "Endurance", "FirstAid", "Health", "HeavyVests", 
                    "HideoutManagement", "HMG", "Immunity", "Intellect", "LightVests", "LMG",
                    "MagDrills", "Melee", "Memory", "Metabolism", "Perception", "Pistol", "ProneMovement",
                    "RecoilControl", "Revolver", "Search",
                    "Shotgun", "SMG", "Sniper", "Sniping", "Strength", "StressResistance",
                    "Surgery", "Throwables", "Troubleshooting",
                    "Troubleshooting", "Vitality", "WeaponModding"
                ];

                if (selectElement.value === 'AssortmentUnlock') {
                    rewardDetails.innerHTML = `
                        <label style="color: #06b600;">The Items _id in assort.json to unlock it on the trader:
                            <input type="text" class="assortment-id" placeholder="Enter reward _id" required>
                        </label>
                        <label style="color: #06b600;">Loyalty Level:
                            <select class="loyalty-level" required>
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </label>
                        <label style="color: #06b600;">Item:</label>
                        <div class="custom-dropdown">
                            <input type="text" class="dropdown-search" placeholder="Search items..." oninput="filterDropdown(this)" onclick="toggleDropdownMenu(this)">
                            <div class="dropdown-menu">
                                ${items.map(item => `
                                    <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                        ${item.displayName}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <label style="color: #06b600;">
                            <input type="checkbox" class="unknown-checkbox"> Hidden Reward
                        </label>
                        <div class="reward-editions" style="display: none;">
                            <label for="available-editions">Available for Profile Editions:</label>
                            <select class="available-editions" multiple>
                                <option value="standard">Standard</option>
                                <option value="left_behind">Left Behind</option>
                                <option value="edge_of_darkness">Edge of Darkness</option>
                                <option value="prepare_for_escape">Prepare for Escape</option>
                                <option value="exhibition">Exhibition</option>
                                <option value="press_edition">Press Edition</option>
                                <option value="tournament_live">Tournament Live</option>
                                <option value="tournament">Tournament</option>
                                <option value="develop">Develop</option>
                            </select>
                            <input type="text" class="custom-edition" placeholder="Enter custom edition">
                        </div>
                    `;
                } else if (selectElement.value === 'Item') {
                    rewardDetails.innerHTML = `
                        <label style="color: #06b600;">Reward Item:</label>
                        <div class="custom-dropdown">
                            <input type="text" class="dropdown-search" placeholder="Search items or enter custom ID..." 
                                oninput="filterDropdown(this)" 
                                onclick="toggleDropdownMenu(this)">
                            <div class="dropdown-menu">
                                ${items.map(item => `
                                    <div class="dropdown-item" data-value="${item._id}" onclick="selectDropdownItem(this)">
                                        ${item.displayName}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <label style="color: #06b600;">Value:
                            <input type="number" placeholder="Quantity" required value="1">
                        </label>
                        <label style="color: #06b600;">
                            <input type="checkbox" class="unknown-checkbox"> Hidden Reward
                        </label>
                        <div class="reward-editions" style="display: none;">
                            <label for="available-editions">Available for Profile Editions:</label>
                            <select class="available-editions" multiple>
                                <option value="standard">Standard</option>
                                <option value="left_behind">Left Behind</option>
                                <option value="edge_of_darkness">Edge of Darkness</option>
                                <option value="prepare_for_escape">Prepare for Escape</option>
                                <option value="exhibition">Exhibition</option>
                                <option value="press_edition">Press Edition</option>
                                <option value="tournament_live">Tournament Live</option>
                                <option value="tournament">Tournament</option>
                                <option value="develop">Develop</option>
                            </select>
                            <input type="text" class="custom-edition" placeholder="Enter custom edition">
                        </div>
                    `;
                } else if (selectElement.value === 'TraderStanding') {
                    rewardDetails.innerHTML = `
                        <label style="color: #06b600;">Trader ID:
                            <input type="text" class="trader-id-reward" placeholder="Enter Trader ID" required>
                        </label>
                        <label style="color: #06b600;">Value:
                            <input type="text" class="reward-value" placeholder="Enter amount of Rep, 0.1, 1, 2.5, etc.."  value="0.1">
                        </label>
                        <label style="color: #06b600;">
                            <input type="checkbox" class="unknown-checkbox"> Hidden Reward
                        </label>
                        <div class="reward-editions" style="display: none;">
                            <label for="available-editions">Available for Profile Editions:</label>
                            <select class="available-editions" multiple>
                                <option value="standard">Standard</option>
                                <option value="left_behind">Left Behind</option>
                                <option value="edge_of_darkness">Edge of Darkness</option>
                                <option value="prepare_for_escape">Prepare for Escape</option>
                                <option value="exhibition">Exhibition</option>
                                <option value="press_edition">Press Edition</option>
                                <option value="tournament_live">Tournament Live</option>
                                <option value="tournament">Tournament</option>
                                <option value="develop">Develop</option>
                            </select>
                            <input type="text" class="custom-edition" placeholder="Enter custom edition">
                        </div>
                    `;
                }
                
                else if (selectElement.value === 'Experience') {
                    rewardDetails.innerHTML = `
                        <label style="color: #06b600;">Value:
                            <input type="text" class="reward-value" placeholder="Enter amount of Experience" value="5000">
                        </label>
                        <label style="color: #06b600;">
                            <input type="checkbox" class="unknown-checkbox"> Hidden Reward
                        </label>
                        <div class="reward-editions" style="display: none;">
                            <label for="available-editions">Available for Profile Editions:</label>
                            <select class="available-editions" multiple>
                                <option value="standard">Standard</option>
                                <option value="left_behind">Left Behind</option>
                                <option value="edge_of_darkness">Edge of Darkness</option>
                                <option value="prepare_for_escape">Prepare for Escape</option>
                                <option value="exhibition">Exhibition</option>
                                <option value="press_edition">Press Edition</option>
                                <option value="tournament_live">Tournament Live</option>
                                <option value="tournament">Tournament</option>
                                <option value="develop">Develop</option>
                            </select>
                            <input type="text" class="custom-edition" placeholder="Enter custom edition">
                        </div>
                    `;
                } else if (selectElement.value === 'Skill') {
                    rewardDetails.innerHTML = `
                        <label style="color: #06b600;">Skill Type:
                            <select class="skill-target">
                                ${skillOptions.map(skill => `<option value="${skill}">${skill}</option>`).join('')}
                            </select>
                        </label>
                        <label style="color: #06b600;">Value: (Psycho Sniper gives value 300 which is 3 levels)
                            <input type="number" class="skill-value" placeholder="Enter value" required  value="1">
                        </label>
                        <label style="color: #06b600;">
                            <input type="checkbox" class="unknown-checkbox"> Hidden Reward
                        </label>
                        <div class="reward-editions" style="display: none;">
                            <label for="available-editions">Available for Profile Editions:</label>
                            <select class="available-editions" multiple>
                                <option value="standard">Standard</option>
                                <option value="left_behind">Left Behind</option>
                                <option value="edge_of_darkness">Edge of Darkness</option>
                                <option value="prepare_for_escape">Prepare for Escape</option>
                                <option value="exhibition">Exhibition</option>
                                <option value="press_edition">Press Edition</option>
                                <option value="tournament_live">Tournament Live</option>
                                <option value="tournament">Tournament</option>
                                <option value="develop">Develop</option>
                            </select>
                            <input type="text" class="custom-edition" placeholder="Enter custom edition">
                        </div>
                    `;
                }
                handleSPTVersionChange();
            }

            function selectRewardItem(item) {
                const dropdown = item.closest('.custom-dropdown');
                const searchInput = dropdown.querySelector('.dropdown-search');
                const dropdownMenu = dropdown.querySelector('.dropdown-menu');

                Array.from(dropdownMenu.children).forEach(child => child.removeAttribute('data-selected'));

                item.setAttribute('data-selected', "true");
                searchInput.value = item.textContent.trim();
                searchInput.dataset.selectedValue = item.getAttribute('data-value');

                dropdownMenu.classList.remove('show');
            }

            function removeReward(button) {
                button.closest('.reward').remove();
            }

            function copyQuest() {
                const outputText = document.getElementById('output').textContent;
                navigator.clipboard.writeText(outputText).then(() => {
                    const button = document.getElementById('copyQuestButton');
                    button.innerText = "Copied to Clipboard";
                    setTimeout(() => button.innerText = "Copy Quest to Clipboard", 3000);
                }).catch(err => {
                    console.error("Failed to copy quest:", err);
                });
            }

            function downloadQuest() {
                const questNumber = document.getElementById('quest-number').value || '0';
                const questName = document.getElementById('quest-name').value.trim().replace(/\s+/g, '_') || 'quest';
                const filename = `${questNumber}_${questName}.json`;

                const outputText = `${document.getElementById('output').textContent}`;
                const blob = new Blob([outputText], { type: "application/json" });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                link.click();
                URL.revokeObjectURL(link.href);

                const button = document.getElementById('downloadQuestButton');
                button.innerText = "Downloaded Quest";
                setTimeout(() => button.innerText = "Download Quest as JSON", 3000);
            }

            function copyLanguageEntries() {
                const languageOutputText = document.getElementById('language-output').textContent;
                navigator.clipboard.writeText(languageOutputText).then(() => {
                    const button = document.getElementById('copyLangButton');
                    button.innerText = "Copied to Clipboard";
                    setTimeout(() => button.innerText = "Copy Language to Clipboard", 3000);
                }).catch(err => {
                    console.error("Failed to copy language variables:", err);
                });
            }

            function downloadLanguageEntries() {
                const questNumber = document.getElementById('quest-number').value || '0';
                const questName = document.getElementById('quest-name').value.trim().replace(/\s+/g, '_') || 'quest';
                const filename = `${questNumber}_${questName}_language.json`;

                const languageOutputText = `${document.getElementById('language-output').textContent}`;
                const blob = new Blob([languageOutputText], { type: "application/json" });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                link.click();
                URL.revokeObjectURL(link.href);

                const button = document.getElementById('downloadLangButton');
                button.innerText = "Downloaded Language";
                setTimeout(() => button.innerText = "Download Language as JSON", 3000);
            }

            function toggleUsefulInfo() {
                const usefulInfoSection = document.getElementById('useful-info');
                usefulInfoVisible = !usefulInfoVisible;

                if (usefulInfoVisible) {
                    usefulInfoSection.style.display = 'block';
                    document.getElementById('toggleUsefulInfoBtn').innerText = 'Hide Useful Info';
                } else {
                    usefulInfoSection.style.display = 'none';
                    document.getElementById('toggleUsefulInfoBtn').innerText = 'Show Useful Info';
                }
            }

            function toggleTopRightBox() {
                const usefulInfoSection = document.getElementById('top-right-box');
                navigationBoxVisible = !navigationBoxVisible;

                if (navigationBoxVisible) {
                    usefulInfoSection.style.display = 'block';
                    document.getElementById('toggleTopRightBoxBtn').innerText = 'Hide Navigation & Page Settings';
                } else {
                    usefulInfoSection.style.display = 'none';
                    document.getElementById('toggleTopRightBoxBtn').innerText = 'Show Navigation & Page Settings';
                }
            }

            function toggleHowToUse() {
                const howToUseSection = document.getElementById('how-to-use');
                howToUseVisible = !howToUseVisible;

                if (howToUseVisible) {
                    howToUseSection.style.display = 'block';
                    document.getElementById('toggleHowToUseBtn').innerText = 'Hide How to Use';
                } else {
                    howToUseSection.style.display = 'none';
                    document.getElementById('toggleHowToUseBtn').innerText = 'Show How to Use';
                }
            }

            function toggleChangelog() {
                const changelogSection = document.getElementById('changelog');
                changelogSection.style.display = changelogSection.style.display === 'none' ? 'block' : 'none';

                const button = document.getElementById('toggleChangelogBtn');
                button.innerText = changelogSection.style.display === 'none' ? 'Show Changelog' : 'Hide Changelog';
            }

            function toggleRoadmap() {
                const roadmapSection = document.getElementById('roadmap');
                roadmapSection.style.display = roadmapSection.style.display === 'none' ? 'block' : 'none';

                const button = document.getElementById('toggleRoadmapBtn');
                button.innerText = roadmapSection.style.display === 'none' ? 'Show Roadmap' : 'Hide Roadmap';
            }

            function toggleMainContent() {
                const mainContent = document.getElementById('main-content');
                mainContent.style.display = mainContent.style.display === 'none' ? 'block' : 'none';

                const button = document.getElementById('toggleMainContentBtn');
                button.innerText = mainContent.style.display === 'none' ? 'Show Main Content' : 'Hide Main Content';
            }

            function updateDynamicQuestPath() {
                const traderId = document.getElementById('trader-name').value.trim() || 'TRADERID';
                const questNumber = document.getElementById('quest-number').value.trim() || '0';
                const questName = document.getElementById('quest-name').value.trim().replace(/\s+/g, '_') || 'quest';
                const questFilename = `${questNumber}_${questName}.json`;

                const pathText = `Copy or download this to your trader folder inside <strong style="color: #9b008e;">SPT\\user\\mods\\Virtuals Custom Quest Loader\\database\\quests\\${traderId}\\</strong>, e.g., <strong style="color: #9b008e;">${questFilename}</strong>`;
                document.getElementById('dynamicQuestPath').innerHTML = pathText;
            }

            function updateDynamicLangPath() {
                const traderId = document.getElementById('trader-name').value.trim() || 'TRADERID';
                const questNumber = document.getElementById('quest-number').value.trim() || '0';
                const questName = document.getElementById('quest-name').value.trim().replace(/\s+/g, '_') || 'quest';
                const langFilename = `${questNumber}_${questName}_Locale.json`;

                const langPathText = `Copy this to your language JSON inside <strong style="color: #9b008e;">SPT\\user\\mods\\Virtuals Custom Quest Loader\\database\\locales\\en\\${traderId}\\</strong>, e.g., <strong style="color: #9b008e;">${langFilename}</strong>`;
                document.getElementById('dynamicLangPath').innerHTML = langPathText;
            }

            function populateLanguageFields() {
                const languageSection = document.getElementById('language-entries-section');
                if (!languageSection) {
                    console.error("languageSection element is null.");
                    return;
                }
                languageSection.innerHTML = '';

                const baseFields = [
                    { id: 'quest-desc-lang', label: 'Quest Description' },
                    { id: 'quest-start-msg-lang', label: 'Quest Started Message' },
                    { id: 'quest-success-msg-lang', label: 'Quest Success Message' },
                    { id: 'quest-fail-msg-lang', label: 'Quest Fail Message' },
                    { id: 'quest-accept-msg-lang', label: 'Quest Accept Message' },
                    { id: 'quest-decline-msg-lang', label: 'Quest Decline Message' },
                    { id: 'quest-complete-msg-lang', label: 'Quest Complete Message' },
                    { id: 'quest-change-msg-lang', label: 'Quest Change Quest Message' },
                    { id: 'quest-note-lang', label: 'Quest Note' }
                ];

                baseFields.forEach(field => {
                    const div = document.createElement('div');
                    div.className = 'dynamic-lang-entry';
                    div.innerHTML = `<label style="color: #06b600;" for="${field.id}">${field.label}:</label>
                                    <textarea id="${field.id}" placeholder="Enter ${field.label.toLowerCase()}" style="width: 100%; resize: vertical;"></textarea>`;
                    languageSection.appendChild(div);
                });

                const conditions = document.querySelectorAll('#conditions-container > .condition');
                conditions.forEach(condition => {
                    const conditionType = condition.querySelector('select').value;
                    const objLabel = condition.getAttribute('data-obj-label');

                    const div = document.createElement('div');
                    div.className = 'dynamic-lang-entry';
                    div.innerHTML = `<label style="color: #06b600;" for="${objLabel}">${objLabel} (${conditionType}):</label>
                                    <input type="text" id="${objLabel}" placeholder="Enter text for ${conditionType} condition">`;
                    languageSection.appendChild(div);
                });

                const rewards = document.querySelectorAll('#rewards-container > .reward');
                rewards.forEach((reward, index) => {
                    const rewardId = `${traderId}_${questNumber} reward_${index}`;
                    const div = document.createElement('div');
                    div.className = 'dynamic-lang-entry';
                    div.innerHTML = `<label style="color: #06b600;" for="${rewardId}">Reward ${index}:</label>
                                    <input type="text" id="${rewardId}" placeholder="Enter reward text">`;
                    languageSection.appendChild(div);
                });
            }

            function addFailCondition() {
                const container = document.getElementById('fail-conditions-container');
                const failDiv = document.createElement('div');
                failDiv.classList.add("fail-condition");

                const failIndex = container.childElementCount;
                const failLabel = generateUniqueId();
                failDiv.setAttribute('data-obj-label', failLabel);

                failDiv.innerHTML = `
                    <section id="fail-condition">
                        <label style="color: #06b600;">Condition Type:
                            <select onchange="updateFailConditionFields(this)">
                                <option value="Level">Level</option>
                                <option value="Location">Location</option>
                                <option value="Quest">Quest</option>
                                <option value="Kills">Kills</option>
                                <option value="ExitStatus">Exit Status</option>
                                <option value="UseItem">Use Item</option>
                                <option value="TraderStanding">Trader Standing</option>
                                <option value="ExitStatusOnLocation">Exit Status On Location</option>
                            </select>
                        </label>
                        <div class="fail-condition-details"></div>
                        <button type="button" onclick="removeFailCondition(this)" style="margin-top: 10px;">Remove Fail Condition</button>
                    </section>
                `;

                container.appendChild(failDiv);
                updateFailConditionFields(failDiv.querySelector('select'));
            }

            function addSubCondition(container) {
                const subConditionDiv = document.createElement('div');
                subConditionDiv.classList.add('counter-subcondition');
                
                subConditionDiv.innerHTML = `
                    <label style="color: #06b600;">Subcondition Type:
                        <select class="subcondition-type-select">
                            <option value="ExitStatus">Exit Status</option>
                            <option value="Location">Location</option>
                        </select>
                    </label>
                    <div class="subcondition-details"></div>
                    
                    <button type="button" class="remove-subcondition-btn" onclick="removeSubCondition(this)" style="margin-top: 10px;">
                        Remove Subcondition
                    </button>
                `;

                container.appendChild(subConditionDiv);

                const selectElement = subConditionDiv.querySelector('.subcondition-type-select');
                selectElement.addEventListener('change', function() {
                    updateSubConditionFields(selectElement);
                });

                updateSubConditionFields(selectElement);
            }

            function removeSubCondition(button) {
                button.closest('.counter-subcondition').remove();
            }

            function updateSubConditionFields(selectElement) {
                const subConditionType = selectElement.value;
                const detailsDiv = selectElement.closest('.counter-subcondition').querySelector('.subcondition-details');
                detailsDiv.innerHTML = '';

                if (subConditionType === 'ExitStatus') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Exit Status:
                            <select multiple>
                                <option value="Killed">Killed</option>
                                <option value="Left">Left</option>
                                <option value="MissingInAction">Missing In Action</option>
                                <option value="Survived">Survived</option>
                                <option value="Runner">Runner</option>
                            </select>
                        </label>
                    `;
                } else if (subConditionType === 'Location') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Locations (select multiple):
                            <select multiple class="location-dropdown">
                                <option value="factory4_day">Factory Day</option>
                                <option value="factory4_night">Factory Night</option>
                                <option value="Interchange">Interchange</option>
                                <option value="Shoreline">Shoreline</option>
                                <option value="Lighthouse">Lighthouse</option>
                                <option value="bigmap">Customs</option>
                                <option value="Woods">Woods</option>
                                <option value="RezervBase">Reserve</option>
                                <option value="laboratory">The Lab</option>
                                <option value="TarkovStreets">Streets</option>
                            </select>
                        </label>
                    `;
                }
            }

            function updateFailConditionFields(selectElement) {
                const detailsDiv = selectElement.closest('.fail-condition').querySelector('.fail-condition-details');
                const conditionType = selectElement.value;
                detailsDiv.innerHTML = '';

                if (conditionType === 'Level') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Compare Method:
                            <select class="compare-method-select">
                                <option value=">=" selected>&ge;</option>
                                <option value="<=">&le;</option>
                            </select>
                        </label>
                        <label style="color: #06b600;">Level:
                            <input type="number" placeholder="Enter level" required>
                        </label>
                    `;
                }
                else if (conditionType === 'Quest') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Quest ID:
                            <input type="text" placeholder="Enter quest ID" required>
                        </label>
                        <label style="color: #06b600;">Quest Status:
                            <select multiple>
                                <option value="1">Available - 1</option>
                                <option value="2">In Progress - 2</option>
                                <option value="3">Finished - 3</option>
                                <option value="4" selected>Confirmed - 4</option>
                                <option value="5">Failed - 5</option>
                            </select>
                        </label>
                    `;
                } else if (selectElement.value === 'Location') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Location (select multiple with ctrl + click):</label>
                        <select multiple class="location-dropdown">
                            <option value="bigmap">Customs</option>
                            <option value="Interchange">Interchange</option>
                            <option value="factory4_day">Factory Day</option>
                            <option value="factory4_night">Factory Night</option>
                            <option value="Woods">Woods</option>
                            <option value="Lighthouse">Lighthouse</option>
                            <option value="Shoreline">Shoreline</option>
                            <option value="RezervBase">Reserve</option>
                            <option value="laboratory">The Lab</option>
                            <option value="TarkovStreets">Streets</option>
                            <option value="Sandbox">Ground Zero (PMC < 20)</option>
                            <option value="Sandbox_high">Ground Zero (PMC > 20)</option>
                        </select>
                    `;
                } else if (selectElement.value === 'Kills') {
                    detailsDiv.innerHTML = `
                        <section id="kills-fail-condition">
                            <label style="color: #06b600;">Target:
                                <select class="target-select" required>
                                    <option value="Savage">Scavs</option>
                                    <option value="AnyPmc">PMCs</option>
                                    <option value="Usec">Usec</option>
                                    <option value="Bear">Bear</option>
                                    <option value="Any" selected>Any</option>
                                </select>
                            </label>
                            
                            <label class="savage-role-label" style="display:none; color: #06b600;">Savage Role (select multiple with ctrl + click):</label>
                            <select class="savage-role-select" style="display:none;" multiple>
                                <option value="">Any</option>
                                <option value="bossKilla">Killa</option>
                                <option value="bossTagilla">Tagilla</option>
                                <option value="bossBully">Reshala</option>
                                <option value="followerBully">Reshala's Bodyguards</option>
                                <option value="bossKojaniy">Schturman</option>
                                <option value="bossGluhar">Gluhar</option>
                                <option value="followerGluharAssault">Gluhar Guard Assault</option>
                                <option value="followerGluharScout">Gluhar Guard Scout</option>
                                <option value="followerGluharSecurity">Gluhar Guard Security</option>
                                <option value="followerGluharSnipe">Gluhar Guard Sniper</option>
                                <option value="pmcBot">Raider</option>
                                <option value="bossSanitar">Sanitar</option>
                                <option value="followerSanitar">Sanitar Bodyguards</option>
                                <option value="bossKnight">Knight</option>
                                <option value="followerBigPipe">BigPipe</option>
                                <option value="followerBirdEye">BirdEye</option>
                                <option value="exUsec">Rogue</option>
                                <option value="marksman">Sniper Scavs</option>
                                <option value="sectantPriest">Cultist Priest</option>
                                <option value="sectantWarrior">Cultist Warrior</option>
                                <option value="arenaFighterEvent">Bloodhound</option>
                            </select>

                            <label style="color: #06b600;">Kills Required:
                                <select class="compare-method-select">
                                    <option value=">=">&ge;</option>
                                    <option value="<=">&le;</option>
                                </select>
                                <input type="number" placeholder="Number of kills" required value="1">
                            </label>

                            <label style="color: #06b600;">Distance (>= 50 means more than or equal to 50m):
                                <select class="equalto">
                                    <option value=">=">&ge;</option>
                                    <option value="<=">&le;</option>
                                </select>
                                <input class="small-number" type="number" placeholder="Distance in meters" required value="0">
                            </label>

                            <label style="color: #06b600;">Time of Day From (0-24):
                                <input id="time-from-input" class="small-number" type="number" min="0" max="24" value="0" required>
                            </label>
                            <label style="color: #06b600;">Time of Day To (0-24):
                                <input id="time-to-input" class="small-number" type="number" min="0" max="24" value="0" required>
                            </label>

                            <label style="color: #06b600;">Select Weapon Caliber (select multiple with ctrl + click):</label>
                            <div class="weapon-caliber-container">
                                <select multiple id="weapon-caliber-select" class="weapon-caliber-dropdown">
                                    <option value="all">All</option>
                                    <option value="543be6564bdc2df4348b4568">Throwable</option>
                                    <option value="5447e1d04bdc2dff2f8b4567">Melee Weapons</option>
                                    <option value="5447bed64bdc2d97278b4568">Machine Guns</option>
                                    <option value="5447b6254bdc2dc3278b4568">Sniper Rifles</option>
                                    <option value="5447b5e04bdc2d62278b4567">SMGs</option>
                                    <option value="5447b6094bdc2dc3278b4567">Shotguns</option>
                                    <option value="5447b5cf4bdc2d65278b4567">Pistol</option>
                                    <option value="5447b6194bdc2d67278b4567">Marksman Rifles</option>
                                    <option value="5447b5f14bdc2d61278b4567">Assault Rifles</option>
                                    <option value="5447b5fc4bdc2d87278b4567">Assault Carbines</option>
                                </select>
                            </div>

                            <label style="color: #06b600;">Target Body Part (select multiple with ctrl + click):</label>
                            <select id="body-part-select" multiple>
                                <option value="">Any</option>
                                <option value="Head">Head</option>
                                <option value="Chest">Chest</option>
                                <option value="Stomach">Stomach</option>
                                <option value="LeftArm">Left Arm</option>
                                <option value="RightArm">Right Arm</option>
                                <option value="LeftLeg">Left Leg</option>
                                <option value="RightLeg">Right Leg</option>
                            </select>

                            <label style="color: #06b600;">Weapon Mods to Include:</label>
                            <div id="weapon-mods-inclusive-container">
                                <button type="button" onclick="addWeaponModInclusive()">Add Weapon Mod to Include</button>
                                <div id="weapon-items-container" class="weapon-mods-inclusive"></div>
                            </div>

                            <label style="color: #06b600;">Weapon Mods to Exclude:</label>
                            <div id="weapon-mods-exclusive-container">
                                <button type="button" onclick="addWeaponModExclusive()">Add Weapon Mod to Exclude</button>
                                <div id="weapon-items-container" class="weapon-mods-exclusive"></div>
                            </div>
                        
                            <label style="color: #06b600;">Items Required to be Equipped:</label>
                            <div id="kills-equipment-inclusive-container">
                                <button type="button" onclick="addInclusiveEquipmentItem()">Add Equipment to Include</button>
                                <div id="equipment-items-container" class="inclusive-equipment-items-container"></div>
                            </div>
                            
                            <label style="color: #06b600;">Items Required to NOT be Equipped:</label>
                            <div id="kills-equipment-exclusive-container">
                                <button type="button" onclick="addExclusiveEquipmentItem()">Add Equipment to Exclude</button>
                                <div id="equipment-items-container" class="exclusive-equipment-items-container"></div>
                            </div>

                            <div style="display: flex; align-items: center; text-align: left;">
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" style="margin-right: 5px;"> Reset on Session End
                                </label>
                            </div>
                        </section>
                    `;

                    const targetSelect = detailsDiv.querySelector('.target-select');
                    if (targetSelect) {
                        targetSelect.addEventListener('change', function () {
                            const savageRoleLabel = detailsDiv.querySelector('.savage-role-label');
                            const savageRoleSelect = detailsDiv.querySelector('.savage-role-select');
                            if (this.value === 'Savage') {
                                savageRoleLabel.style.display = 'block';
                                savageRoleSelect.style.display = 'block';
                            } else {
                                savageRoleLabel.style.display = 'none';
                                savageRoleSelect.style.display = 'none';
                            }
                        });
                    }
                } else if (conditionType === 'ExitStatusOnLocation') {
                    detailsDiv.innerHTML = `
                        <div class="counter-conditions-container"></div>
                        <button type="button" onclick="addSubCondition(document.querySelector('.counter-conditions-container'))" style="margin-top: 10px;">Add Subcondition</button>
                        <label style="color: #06b600;">
                            <input type="checkbox" class="reset-counter-checkbox"> Do Not Reset If Counter Completed
                        </label>
                        <label style="color: #06b600;">
                            <input type="checkbox" class="one-session-only-checkbox"> One Session Only
                        </label>
                    `;
                } else if (conditionType === 'ExitStatus') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Exit Status:
                            <select multiple>
                                <option value="Survived">Survived</option>
                                <option value="Runner">Runner</option>
                                <option value="Killed">Killed</option>
                                <option value="Left">Left</option>
                                <option value="MissingInAction">Missing In Action</option>
                            </select>
                        </label>
                    `;
                } else if (conditionType === 'UseItem') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Fail Condition Target Items:</label>
                        <div class="target-items-fail-container"></div>
                        <button type="button" onclick="addTargetItemFail(document.querySelector('.target-items-fail-container'))" style="margin-top: 10px; width: auto;">Add New Item</button>

                        <label style="color: #06b600;">Value:
                            <select class="compare-method-select">
                                <option value=">=">&ge;</option>
                                <option value="<=">&le;</option>
                            </select>
                            <input type="number" class="use-item-value" placeholder="Enter value" required value="1">
                        </label>
                    `;
                } else if (conditionType === 'TraderStanding') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Standing Value:
                            <select class="compare-method-select">
                                <option value=">=">>=</option>
                                <option value="<="><=</option>
                            </select>
                            <input type="number" class="standing-value-input" placeholder="Enter standing value" required>
                        </label>
                        
                        <label style="color: #06b600;">Trader ID:
                            <input type="text" class="trader-id-input" placeholder="Enter Trader ID" required>
                        </label>
                    `;
                }
            }

            function removeFailCondition(button) {
                button.closest('.fail-condition').remove();
            }

            function addAvailableForStartCondition() {
                const container = document.getElementById('available-for-start-container');
                const conditionDiv = document.createElement('div');
                conditionDiv.classList.add("condition");

                const conditionIndex = container.childElementCount;
                const objLabel = generateUniqueId();
                conditionDiv.setAttribute('data-obj-label', objLabel);

                conditionDiv.innerHTML = `
                    <label style="color: #06b600;">Condition Type:
                        <select onchange="updateAvailableForStartFields(this)">
                            <option value="Level">Level</option>
                            <option value="Quest">Quest</option>
                            <option value="TraderLoyalty">Trader Loyalty</option>
                        </select>
                    </label>
                    <div class="available-for-start-details"></div>
                    <button type="button" onclick="removeAvailableForStartCondition(this)" style="margin-top: 10px;">Remove</button>
                `;
                container.appendChild(conditionDiv);

                container.style.display = 'block';
                updateAvailableForStartFields(conditionDiv.querySelector('select'));
            }

            function removeAvailableForStartCondition(button) {
                const container = document.getElementById('available-for-start-container');
                const conditionDiv = button.closest('.condition');
                conditionDiv.remove();

                if (container.children.length === 0) {
                    container.style.display = 'none';
                }
            }

            function updateAvailableForStartFields(selectElement) {
                const detailsDiv = selectElement.closest('.condition').querySelector('.available-for-start-details');
                const conditionType = selectElement.value;
                detailsDiv.innerHTML = '';

                if (conditionType === 'Level') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Compare Method:
                            <select class="compare-method-select">
                                <option value=">=" selected>&ge;</option>
                                <option value="<=">&le;</option>
                            </select>
                        </label>
                        <label style="color: #06b600;">Level:
                            <input type="number" placeholder="Enter level" required>
                        </label>
                    `;
                } else if (conditionType === 'Quest') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Quest ID:
                            <input type="text" placeholder="Enter quest ID" required>
                        </label>
                        <label style="color: #06b600;">Quest Status:
                            <select multiple>
                                <option value="1">Available - 1</option>
                                <option value="2">In Progress - 2</option>
                                <option value="3">Finished - 3</option>
                                <option value="4" selected>Confirmed - 4</option>
                                <option value="5">Failed - 5</option>
                            </select>
                        </label>
                    `;
                } else if (conditionType === 'TraderLoyalty') {
                    detailsDiv.innerHTML = `
                        <label style="color: #06b600;">Trader ID:
                            <input type="text" placeholder="Enter trader ID" required>
                        </label>
                        <label style="color: #06b600;">Loyalty Level:
                            <select>
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </label>
                    `;
                }
            }

            function copyAssortments() {
                const assortmentsText = document.getElementById('assortments-output').textContent;
                navigator.clipboard.writeText(assortmentsText).then(() => {
                    const button = document.getElementById('copyAssortmentsButton');
                    button.innerText = "Copied to Clipboard";
                    setTimeout(() => button.innerText = "Copy Assortments to Clipboard", 3000);
                }).catch(err => {
                    console.error("Failed to copy assortments:", err);
                });
            }

            function generateVisibilityConditions(div, conditionId) {
                const visibilityTargetId = div.querySelector('.visibility-target')?.value;
                if (visibilityTargetId) {
                    return [{
                        conditionType: "CompleteCondition",
                        id: generateUniqueId(),
                        target: visibilityTargetId
                    }];
                }
                return [];
            }

            function savageSelection() {
                const targetSelect = document.querySelector('select[required]');
                const savageRoleLabel = document.getElementById('savage-role-label');
                const savageRoleSelect = document.getElementById('savage-role-select');

                if (targetSelect.value === 'Savage') {
                    savageRoleLabel.style.display = 'inline';
                    savageRoleSelect.style.display = 'inline';
                }
            }

            function weaponCaliberSelection() {
                const weaponCaliberSelect = document.getElementById('weapon-caliber-select');
                if (weaponCaliberSelect) {
                    weaponCaliberSelect.addEventListener('change', handleWeaponCaliberSelection);
                }
            }

            function generateUniqueId() {
                const timestamp = Math.floor(new Date().getTime() / 1000).toString(16);
                const objectId = timestamp + 'xxxxxxxxxxxxxxxx'.replace(/[x]/g, () => {
                    return Math.floor(Math.random() * 16).toString(16);
                }).toLowerCase();

                return objectId;
            }

            function generateQuest() {
                const questName = document.getElementById('quest-name').value;
                const questNameID = generateUniqueId();
                const trader = document.getElementById('trader-name').value || 'TRADERNAME';
                const questNumber = document.getElementById('quest-number').value || '0';
                const questImage = document.getElementById('quest-image').value || 'quest_image.png';
                const questType = document.getElementById('quest-type').value;
                const questlocation = document.getElementById('quest-location-dropdown').value;
                const faction = document.getElementById('faction-dropdown').value;

                // Start Conditions
                const availableForStartConditions = Array.from(document.querySelectorAll('#available-for-start-container > .condition')).map((div, index) => {
                    const conditionType = div.querySelector('select').value;
                    
                    if (conditionType === 'Level') {
                        const compareSelect = div.querySelector('.compare-method-select');
                        const levelInput = div.querySelector('input[type=number]');

                        return {
                            compareMethod: compareSelect ? compareSelect.value : '',
                            conditionType: 'Level',
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: generateUniqueId(),
                            index,
                            parentId: "",
                            value: levelInput ? parseInt(levelInput.value, 10) : 0,
                            visibilityConditions: []
                        };
                    } else if (conditionType === 'Quest') {
                        const statusOptions = div.querySelectorAll('select[multiple] option:checked');
                        const statusValues = statusOptions.length > 0 ? Array.from(statusOptions).map(opt => parseInt(opt.value, 10)) : [];
                        const targetInput = div.querySelector('input[type=text]');
                        
                        return {
                            availableAfter: 0,
                            conditionType: 'Quest',
                            dispersion: 0,
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: generateUniqueId(),
                            index,
                            parentId: "",
                            status: statusValues,
                            target: targetInput ? targetInput.value : '',
                            visibilityConditions: []
                        };
                    } else if (conditionType === 'TraderLoyalty') {
                        const targetInput = div.querySelector('input[type=text]');
                        const valueInput = div.querySelector('input[type=number]');
                        
                        return {
                            compareMethod: compareSelect ? compareSelect.value : '',
                            conditionType: 'TraderLoyalty',
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: generateUniqueId(),
                            index,
                            parentId: "",
                            target: targetInput ? targetInput.value : '',
                            value: valueInput ? parseInt(valueInput.value, 10) : 0,
                            visibilityConditions: []
                        };
                    }
                    return {};
                });

                // Objective Conditions
                const conditions = Array.from(document.querySelectorAll('#conditions-container > .condition')).map((div, index) => {
                    const conditionType = div.querySelector('select').value;
                    const conditionId = div.getAttribute('data-obj-label') || (() => {
                        const newId = generateUniqueId();
                        div.setAttribute('data-obj-label', newId);
                        return newId;
                    })();

                    // FindItem or HandoverItem Condition
                    if (conditionType === 'FindItem') {
                        const targetItems = Array.from(div.querySelectorAll('.target-items-container .target-item .dropdown-search'))
                            .map(input => input.dataset.selectedValue || input.value).filter(Boolean);

                        return {
                            conditionType,
                            countInRaid: false,
                            dogtagLevel: 0,
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: conditionId,
                            index,
                            isEncoded: false,
                            maxDurability: 100,
                            minDurability: 0,
                            onlyFoundInRaid: div.querySelector('input[type=checkbox]').checked,
                            parentId: "",
                            target: targetItems,
                            value: parseInt(div.querySelector('input[type=number]').value, 10),
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    } else if (conditionType === 'HandoverItem') {
                        const targetItems = Array.from(div.querySelectorAll('.target-items-container .target-item .dropdown-search'))
                            .map(input => input.dataset.selectedValue || input.value).filter(Boolean);

                        return {
                            conditionType,
                            dogtagLevel: 0,
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: conditionId,
                            index,
                            isEncoded: false,
                            maxDurability: 100,
                            minDurability: 0,
                            onlyFoundInRaid: div.querySelector('input[type=checkbox]').checked,
                            parentId: "",
                            target: targetItems,
                            value: parseInt(div.querySelector('input[type=number]').value, 10),
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    }
                    // Kill Condition
                    else if (conditionType === 'Kills') {
                        const targetSelect = div.querySelector('#target-select');
                        const killsRequiredInput = div.querySelector('input[type=number]');
                        const timeFromInput = div.querySelector('#time-from-input');
                        const timeToInput = div.querySelector('#time-to-input');
                        const bodyPartSelect = div.querySelector('#body-part-select');
                        const selectedBodyParts = Array.from(bodyPartSelect.selectedOptions).map(option => option.value);
                        const distanceComparisonSelect = div.querySelector('.equalto');
                        const distanceValueInput = div.querySelector('.small-number');
                        const savageRoleSelect = div.querySelector('#savage-role-select');
                        const weaponCaliberSelect = div.querySelectorAll('#weapon-caliber-select option:checked');
                        const weaponModsInclusive = Array.from(div.querySelectorAll('.weapon-mods-inclusive .dropdown-search')).map(input => getTplId(input));
                        const weaponModsExclusive = Array.from(div.querySelectorAll('.weapon-mods-exclusive .dropdown-search')).map(input => getTplId(input));
                        const selectedSavageRoles = Array.from(savageRoleSelect.selectedOptions).map(option => option.value);
                        
                        const inclusiveEquipment = Array.from(div.querySelectorAll('.inclusive-equipment-items-container .dropdown-search'))
                            .map(input => input.dataset.selectedValue)
                            .filter(id => id !== undefined && id !== "");

                        const exclusiveEquipment = Array.from(div.querySelectorAll('.exclusive-equipment-items-container .dropdown-search'))
                            .map(input => input.dataset.selectedValue)
                            .filter(id => id !== undefined && id !== "");
                            
                        const inZoneConditionElements = div.querySelectorAll('.subcondition');
                        let additionalConditions = [];

                        // Process each additional condition (like InZone or Location)
                        inZoneConditionElements.forEach(subcondition => {
                            const subconditionType = subcondition.querySelector('.subcondition-type').value;
                            if (subconditionType === 'InZone') {
                                const zoneIds = subcondition.querySelector('.zoneid-inzone').value.split(',').map(id => id.trim());
                                additionalConditions.push({
                                    conditionType: 'InZone',
                                    dynamicLocale: false,
                                    id: generateUniqueId(),
                                    zoneIds: zoneIds
                                });
                            } else if (subconditionType === 'Location') {
                                const selectedLocations = Array.from(subcondition.querySelector('.location-dropdown').selectedOptions).map(option => option.value);
                                additionalConditions.push({
                                    conditionType: 'Location',
                                    dynamicLocale: false,
                                    id: generateUniqueId(),
                                    target: selectedLocations
                                });
                            }
                        });

                        // Main Kills condition
                        const mainKillCondition = {
                            bodyPart: selectedBodyParts,
                            compareMethod: distanceComparisonSelect ? distanceComparisonSelect.value : '>=',
                            conditionType: "Kills",
                            daytime: {
                                from: timeFromInput && timeFromInput.value ? parseInt(timeFromInput.value, 10) : 0,
                                to: timeToInput && timeToInput.value ? parseInt(timeToInput.value, 10) : 0
                            },
                            distance: {
                                compareMethod: distanceComparisonSelect ? distanceComparisonSelect.value : '>=',
                                value: distanceValueInput ? parseInt(distanceValueInput.value, 10) : 0
                            },
                            dynamicLocale: false,
                            enemyEquipmentExclusive: [],
                            enemyEquipmentInclusive: [],
                            enemyHealthEffects: [],
                            id: generateUniqueId(),
                            resetOnSessionEnd: false,
                            savageRole: targetSelect.value === 'Savage' ? selectedSavageRoles : [],
                            target: targetSelect ? targetSelect.value : 'Any',
                            value: killsRequiredInput ? parseInt(killsRequiredInput.value, 10) : 1,
                            weapon: [],
                            weaponCaliber: Array.from(weaponCaliberSelect).map(option => option.value),
                            weaponModsInclusive: weaponModsInclusive.length > 0 ? weaponModsInclusive : [],
                            weaponModsExclusive: weaponModsExclusive.length > 0 ? weaponModsExclusive : [],
                            equipmentInclusive: inclusiveEquipment,
                            equipmentExclusive: exclusiveEquipment,
                        };

                        // Combine the main Kills condition with additional conditions
                        return {
                            completeInSeconds: 0,
                            conditionType: "CounterCreator",
                            counter: {
                                conditions: [mainKillCondition, ...additionalConditions],
                                id: generateUniqueId()
                            },
                            doNotResetIfCounterCompleted: false,
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: generateUniqueId(),
                            index: index,
                            oneSessionOnly: false,
                            parentId: "",
                            type: "Elimination",
                            value: killsRequiredInput ? parseInt(killsRequiredInput.value, 10) : 1,
                            visibilityConditions: []
                        };
                    }
                    // VisitPlace Condition
                    else if (conditionType === 'VisitPlace') {
                        return {
                            completeInSeconds: 0,
                            conditionType: 'CounterCreator',
                            counter: {
                                conditions: [
                                    {
                                        conditionType: "VisitPlace",
                                        dynamicLocale: false,
                                        id: conditionId,
                                        target: div.querySelector('.visit-place-target').value
                                    }
                                ],
                                id: `${conditionId}_counter`
                            },
                            doNotResetIfCounterCompleted: false,
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: conditionId,
                            index: index,
                            oneSessionOnly: div.querySelector('.visit-place-one-session-only').checked,
                            parentId: "",
                            type: "Exploration",
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    }
                    // Skill Condition
                    else if (conditionType === 'Skill') {
                        const compareSelect = div.querySelector('select:nth-of-type(1)');
                        return {
                            compareMethod: compareSelect ? compareSelect.value : '',
                            conditionType: "Skill",
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: conditionId,
                            index: index,
                            parentId: "",
                            target: div.querySelector('.skill-target').value,
                            value: parseInt(div.querySelector('.skill-value').value, 10),
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    }
                    // Equipment Condition
                    else if (conditionType === 'Equipment') {
                        const inclusiveItems = Array.from(div.querySelectorAll('.inclusive-items-container .dropdown-search'))
                            .map(input => getTplId(input));
                        const exclusiveItems = Array.from(div.querySelectorAll('.exclusive-items-container .dropdown-search'))
                            .map(input => getTplId(input));

                        return {
                            includeNotEquippedItems: false,
                            conditionType: "Equipment",
                            index: index,
                            dynamicLocale: false,
                            equipmentExclusive: exclusiveItems,
                            equipmentInclusive: inclusiveItems,
                            id: conditionId,
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    }

                    // Location Condition
                    else if (conditionType === 'Location') {
                        const selectedLocations = Array.from(div.querySelector('.location-dropdown').selectedOptions).map(option => option.value);
                        return {
                            conditionType: "Location",
                            dynamicLocale: false,
                            id: conditionId,
                            index: index,
                            target: selectedLocations,
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    }

                    // ExitStatus Condition
                    else if (conditionType === 'ExitStatus') {
                        const selectedStatuses = Array.from(div.querySelector('.exit-status-dropdown').selectedOptions).map(option => option.value);
                        const doNotResetIfCounterCompleted = div.querySelector('#doNotResetIfCounterCompleted').checked;
                        const counterValue = parseInt(div.querySelector('#counter-value').value, 10);
                        const subconditionElements = div.querySelectorAll('.subcondition');
                        const subconditions = [];

                        subconditionElements.forEach(subcondition => {
                            const subconditionType = subcondition.querySelector('.subcondition-type').value;
                            const subconditionId = generateUniqueId();

                            if (subconditionType === 'Location') {
                                const selectedLocations = Array.from(subcondition.querySelector('.location-dropdown').selectedOptions).map(option => option.value);
                                subconditions.push({
                                    conditionType: 'Location',
                                    dynamicLocale: false,
                                    id: subconditionId,
                                    target: selectedLocations
                                });
                            } else if (subconditionType === 'Exfil') {
                                const role = subcondition.querySelector('.role-select').value;
                                const map = subcondition.querySelector('.map-select').value;
                                const exfilPoint = subcondition.querySelector('.exfil-dropdown').value;
                                const customExfil = subcondition.querySelector('.custom-exfil').value.trim();

                                subconditions.push({
                                    conditionType: 'ExitName',
                                    dynamicLocale: false,
                                    exitName: customExfil || exfilPoint,
                                    id: subconditionId
                                });
                            }
                        });

                        return {
                            completeInSeconds: 0,
                            conditionType: 'CounterCreator',
                            counter: {
                                conditions: [
                                    {
                                        conditionType: "ExitStatus",
                                        dynamicLocale: false,
                                        id: generateUniqueId(),
                                        status: selectedStatuses
                                    },
                                    ...subconditions
                                ],
                                id: generateUniqueId()
                            },
                            doNotResetIfCounterCompleted,
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: conditionId,
                            index,
                            oneSessionOnly: false,
                            parentId: "",
                            type: "Completion",
                            value: counterValue,
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    }
                    // InZone Condition
                    else if (conditionType === 'InZone') {
                        const zoneIds = div.querySelector('input[type="text"]').value.split(',').map(id => id.trim());
                        return {
                            conditionType: "InZone",
                            dynamicLocale: false,
                            id: conditionId,
                            zoneIds: zoneIds
                        };
                    }
                    // LeaveItemAtLocation Condition
                    else if (conditionType === 'LeaveItemAtLocation') {
                        const items = Array.from(div.querySelectorAll('.target-item .dropdown-search')).map(input => getTplId(input));

                        return {
                            conditionType: "LeaveItemAtLocation",
                            dogtagLevel: parseInt(div.querySelector('input[placeholder="Enter required dogtag level"]').value, 10),
                            id: conditionId,
                            index: index,
                            isEncoded: false,
                            maxDurability: parseInt(div.querySelector('input[placeholder="Enter maximum item durability"]').value, 10),
                            minDurability: parseInt(div.querySelector('input[placeholder="Enter minimum item durability"]').value, 10),
                            onlyFoundInRaid: div.querySelector('input[type="checkbox"]').checked,
                            parentId: "",
                            plantTime: parseInt(div.querySelector('input[placeholder="Enter plant time in seconds"]').value, 10),
                            target: items,
                            value: parseInt(div.querySelector('input[placeholder="Enter quantity of item to plant"]').value, 10),
                            visibilityConditions: generateVisibilityConditions(div, conditionId),
                            zoneId: div.querySelector('input[placeholder="Enter zone ID (e.g., Saving_The_Mole)"]').value.trim(),
                            dynamicLocale: false
                        };
                    }
                    // PlaceBeacon Condition
                    else if (conditionType === 'PlaceBeacon') {
                        const targetItem = div.querySelector('.dropdown-search').getAttribute('data-selected-value') || '';
                        const zoneId = div.querySelector('.place-beacon-zoneid').value;
                        const plantTime = parseInt(div.querySelector('.place-beacon-planttime').value, 10);
                        const value = parseInt(div.querySelector('.place-beacon-value').value, 10);

                        return {
                            conditionType: "PlaceBeacon",
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: generateUniqueId(),
                            index,
                            parentId: "",
                            plantTime: plantTime,
                            target: [targetItem],
                            value: value,
                            visibilityConditions: [],
                            zoneId: zoneId
                        };
                    } else if (conditionType === 'TraderLoyalty') {
                        const targetInput = div.querySelector('input[type=text]');
                        const valueInput = div.querySelector('.loyalty-level-condition');
                        const compareMethod = div.querySelector('.compare-method-select').value;

                        return {
                            compareMethod: compareMethod,
                            conditionType: 'TraderLoyalty',
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: generateUniqueId(),
                            index,
                            parentId: "",
                            target: targetInput ? targetInput.value : '',
                            value: valueInput ? parseInt(valueInput.value, 10) : 0,
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    }

                    return {};
                });

                const failConditions = Array.from(document.querySelectorAll('#fail-conditions-container > .fail-condition')).map((div, index) => {
                    const conditionType = div.querySelector('select').value;
                    const conditionId = generateUniqueId();

                    if (conditionType === 'Level') {
                        const compareSelect = div.querySelector('.compare-method-select');
                        return {
                            compareMethod: compareSelect ? compareSelect.value : '',
                            conditionType: 'Level',
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: conditionId,
                            index: index,
                            parentId: "",
                            value: parseInt(div.querySelector('input[type="number"]').value, 10),
                            visibilityConditions: []
                        };
                    } else if (conditionType === 'Location') {
                        const selectedLocations = Array.from(div.querySelector('.location-dropdown').selectedOptions).map(option => option.value);
                        return {
                            conditionType: "Location",
                            dynamicLocale: false,
                            id: conditionId,
                            index: index,
                            target: selectedLocations,
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    } else if (conditionType === 'Quest') {
                        const statusValues = Array.from(div.querySelectorAll('select[multiple] option:checked')).map(opt => parseInt(opt.value, 10));
                        return {
                            availableAfter: 0,
                            conditionType: 'Quest',
                            dispersion: 0,
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: conditionId,
                            index: index,
                            parentId: "",
                            status: statusValues,
                            target: div.querySelector('input[type="text"]').value,
                            visibilityConditions: []
                        };
                    } else if (conditionType === 'Kills') {
                        const locationDropdown = div.querySelector('.location-dropdown');
                        const targetSelect = div.querySelector('#target-select');
                        const compareSelect = div.querySelector('.compare-method-select');
                        const killsRequiredInput = div.querySelector('input[type="number"]');
                        const timeFromInput = div.querySelector('#time-from-input');
                        const timeToInput = div.querySelector('#time-to-input');
                        const bodyPartSelect = div.querySelector('#body-part-select');
                        const selectedBodyParts = Array.from(bodyPartSelect.selectedOptions).map(option => option.value);
                        const distanceComparisonSelect = div.querySelector('.distance-compare-select');
                        const distanceValueInput = div.querySelector('.distance-value-input');
                        const savageRoleSelect = div.querySelector('#savage-role-select');
                        const weaponCaliberSelect = div.querySelectorAll('#weapon-caliber-select option:checked');
                        const weaponModsInclusive = Array.from(div.querySelectorAll('.weapon-mods-inclusive .dropdown-search')).map(input => getTplId(input));
                        const weaponModsExclusive = Array.from(div.querySelectorAll('.weapon-mods-exclusive .dropdown-search')).map(input => getTplId(input));
                        const selectedSavageRoles = Array.from(savageRoleSelect.selectedOptions).map(option => option.value);
                        const inclusiveEquipment = Array.from(div.querySelectorAll('.inclusive-equipment-items-container .dropdown-search'))
                            .map(input => input.dataset.selectedValue)
                            .filter(id => id !== undefined && id !== "");

                        const exclusiveEquipment = Array.from(div.querySelectorAll('.exclusive-equipment-items-container .dropdown-search'))
                            .map(input => input.dataset.selectedValue)
                            .filter(id => id !== undefined && id !== "");
                        
                        return {
                            conditionType: "Kills",
                            id: conditionId,
                            index: index,
                            dynamicLocale: false,
                            location: locationDropdown ? locationDropdown.value : 'any',
                            target: targetSelect ? targetSelect.value : 'Any',
                            compareMethod: compareSelect ? compareSelect.value : '',
                            value: killsRequiredInput ? parseInt(killsRequiredInput.value, 10) : 1,
                            daytime: {
                                from: timeFromInput && timeFromInput.value ? parseInt(timeFromInput.value, 10) : 0,
                                to: timeToInput && timeToInput.value ? parseInt(timeToInput.value, 10) : 0
                            },
                            bodyPart: selectedBodyParts,
                            distance: {
                                compareMethod: distanceComparisonSelect ? distanceComparisonSelect.value : '>=',
                                value: distanceValueInput ? parseInt(distanceValueInput.value, 10) : 0
                            },
                            savageRole: targetSelect.value === 'Savage' ? selectedSavageRoles : [],
                            weaponCaliber: Array.from(weaponCaliberSelect).map(option => option.value),
                            weaponModsInclusive: weaponModsInclusive.length > 0 ? weaponModsInclusive : [],
                            weaponModsExclusive: weaponModsExclusive.length > 0 ? weaponModsExclusive : [],
                            equipmentInclusive: inclusiveEquipment,
                            equipmentExclusive: exclusiveEquipment,
                            resetOnSessionEnd: false,
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    } else if (conditionType === 'ExitStatus') {
                        const statusValues = Array.from(div.querySelectorAll('select[multiple] option:checked')).map(opt => opt.value);
                        return {
                            conditionType: "ExitStatus",
                            id: conditionId,
                            index,
                            status: statusValues,
                            visibilityConditions: []
                        };
                    } else if (conditionType === 'UseItem') {
                        const compareMethod = div.querySelector('.compare-method-select').value;
                        const targetItems = Array.from(div.querySelectorAll('.target-items-fail-container .target-item-fail .dropdown-search-fail'))
                        .map(input => input.dataset.selectedValue || input.value)
                        .filter(Boolean);
                        
                        const value = parseInt(div.querySelector('.use-item-value').value, 10);
                        
                        const useItemCondition = {
                            compareMethod: compareMethod,
                            conditionType: "UseItem",
                            dynamicLocale: false,
                            id: conditionId,
                            target: targetItems,
                            value: value,
                        };
                        
                        conditions.push(useItemCondition);
                    } else if (conditionType === 'TraderStanding') {
                        return {
                            compareMethod: div.querySelector('.compare-method-select').value,
                            conditionType: "TraderStanding",
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: conditionId,
                            index: index,
                            target: div.querySelector('.trader-id-input').value,
                            value: parseInt(div.querySelector('.standing-value-input').value, 10),
                            visibilityConditions: []
                        };
                    } else if (conditionType === 'ExitStatusOnLocation') {
                        const subConditions = Array.from(div.querySelectorAll('.counter-conditions-container .counter-subcondition')).map((subDiv) => {
                            const subConditionType = subDiv.querySelector('.subcondition-type-select').value;
                            const subConditionId = generateUniqueId();

                            if (subConditionType === 'ExitStatus') {
                                const statusValues = Array.from(subDiv.querySelector('select[multiple]').selectedOptions).map(option => option.value);
                                return {
                                    conditionType: "ExitStatus",
                                    dynamicLocale: false,
                                    id: subConditionId,
                                    status: statusValues
                                };
                            } else if (subConditionType === 'Location') {
                                const selectedLocations = Array.from(subDiv.querySelector('.location-dropdown').selectedOptions).map(option => option.value);
                                return {
                                    conditionType: "Location",
                                    dynamicLocale: false,
                                    id: subConditionId,
                                    target: selectedLocations
                                };
                            }
                        });

                        return {
                            completeInSeconds: 0,
                            conditionType: "CounterCreator",
                            counter: {
                                conditions: subConditions,
                                id: generateUniqueId()
                            },
                            doNotResetIfCounterCompleted: div.querySelector('.reset-counter-checkbox').checked,
                            dynamicLocale: false,
                            globalQuestCounterId: "",
                            id: conditionId,
                            index: index,
                            oneSessionOnly: div.querySelector('.one-session-only-checkbox').checked,
                            parentId: "",
                            type: "Exploration",
                            value: 1,
                            visibilityConditions: generateVisibilityConditions(div, conditionId)
                        };
                    }

                    return {};
                });

                const startedRewards = generateStartedRewards();
                const version = document.getElementById('spt-version').value;

                // Rewards
                const rewards = Array.from(document.querySelectorAll('#rewards-container > .reward')).map((div, index) => {
                    const rewardType = div.querySelector('select').value;
                    const rewardId = generateUniqueId();
                    let availableInGameEditions = [];
                    if (version === '3.10') {
                        const selectedOptions = Array.from(div.querySelector('.available-editions')?.selectedOptions || [])
                            .map(option => option.value);
                        const customEdition = div.querySelector('.custom-edition')?.value.trim();
                        if (customEdition) {
                            selectedOptions.push(customEdition);
                        }
                        availableInGameEditions = selectedOptions.length > 0 ? selectedOptions : [];
                    }

                    // Experience Reward
                    if (rewardType === 'Experience') {
                        const valueInput = div.querySelector('.reward-value'); 
                        const unknownCheckbox = div.querySelector('.unknown-checkbox');
                        return {
                            availableInGameEditions,
                            id: rewardId,
                            index: index,
                            type: rewardType,
                            value: valueInput ? valueInput.value.replace(',', '.') || "0" : "0",
                            unknown: unknownCheckbox ? unknownCheckbox.checked : false,
                        };
                    } 
                    // Trader Standing Reward
                    else if (rewardType === 'TraderStanding') {
                        const valueInput = div.querySelector('.reward-value');
                        const unknownCheckbox = div.querySelector('.unknown-checkbox');
                        const traderIdReward = div.querySelector('.trader-id-reward').value;
                        return {
                            availableInGameEditions,
                            id: rewardId,
                            index: index,
                            target: traderIdReward,
                            type: 'TraderStanding',
                            value: valueInput ? valueInput.value.replace(',', '.') || "0" : "0",
                            unknown: unknownCheckbox ? unknownCheckbox.checked : false,
                        };
                    }
                    // Item Reward 
                    else if (rewardType === 'Item') {
                        const inputElement = div.querySelector('.dropdown-search');
                        const itemId = inputElement.dataset.selectedValue || inputElement.value.trim(); // Use input value if no item selected
                        const stackCount = parseInt(div.querySelector('input[type=number]').value, 10);
                        const uniqueId = generateUniqueId();
                        const unknownCheckbox = div.querySelector('.unknown-checkbox');

                        return {
                            availableInGameEditions,
                            findInRaid: true,
                            id: rewardId,
                            index,
                            items: [
                                {
                                    _id: uniqueId,
                                    _tpl: itemId,
                                    upd: {
                                        StackObjectsCount: stackCount
                                    }
                                }
                            ],
                            target: uniqueId,
                            type: rewardType,
                            value: stackCount.toString(),
                            unknown: unknownCheckbox ? unknownCheckbox.checked : false
                        };
                    }
                    // Assortment Unlock Reward
                    else if (rewardType === 'AssortmentUnlock') {
                        const unknownCheckbox = div.querySelector('.unknown-checkbox');
                        const inputElement = div.querySelector('.dropdown-search');
                        const itemId = getTplId(inputElement);

                        return {
                            availableInGameEditions,
                            id: rewardId,
                            index: index,
                            items: [{ _id: div.querySelector('.assortment-id').value, _tpl: itemId }],
                            loyaltyLevel: parseInt(div.querySelector('.loyalty-level').value, 10),
                            target: div.querySelector('.assortment-id').value,
                            traderId: trader,
                            type: 'AssortmentUnlock',
                            unknown: unknownCheckbox ? unknownCheckbox.checked : false
                        };
                    }
                    // Skill Reward 
                    else if (rewardType === 'Skill') {
                        const targetSkill = div.querySelector('.skill-target').value;
                        const skillValue = div.querySelector('.skill-value').value || "0";
                        const unknownCheckbox = div.querySelector('.unknown-checkbox');
                        return {
                            availableInGameEditions,
                            id: rewardId,
                            index: index,
                            target: targetSkill,
                            type: 'Skill',
                            unknown: unknownCheckbox ? unknownCheckbox.checked : false,
                            value: skillValue
                        };
                    } 
                    return {};
                });

                let languageEntries = {};

                const entries = {
                    [`${questNameID} name`]: questName,
                    [`${questNameID} description`]: document.getElementById('quest-desc-lang').value,
                    [`${questNameID} startedMessageText`]: document.getElementById('quest-start-msg-lang').value,
                    [`${questNameID} successMessageText`]: document.getElementById('quest-success-msg-lang').value,
                    [`${questNameID} failMessageText`]: document.getElementById('quest-fail-msg-lang').value,
                    [`${questNameID} acceptPlayerMessage`]: document.getElementById('quest-accept-msg-lang').value,
                    [`${questNameID} declinePlayerMessage`]: document.getElementById('quest-decline-msg-lang').value,
                    [`${questNameID} completePlayerMessage`]: document.getElementById('quest-complete-msg-lang').value,
                    [`${questNameID} changeQuestMessageText`]: document.getElementById('quest-change-msg-lang').value,
                    [`${questNameID} name`]: questName,
                    [`${questNameID} note`]: document.getElementById('quest-note-lang').value
                };

                for (const key in entries) {
                    if (entries[key]) {
                        languageEntries[key] = entries[key];
                    }
                }

                const languageContainer = document.getElementById('dynamic-lang-variables-container');
                const dynamicLangFields = languageContainer.querySelectorAll('.dynamic-lang-entry input[type="text"]');
                dynamicLangFields.forEach(input => {
                    const fieldId = input.id;
                    languageEntries[fieldId] = input.value.replace(/\n/g, '\\n') || '';
                });

                // Quest Assortments
                const assortments = {};
                rewards.forEach(reward => {
                    if (reward.type === 'AssortmentUnlock' && reward.target) {
                        assortments[reward.target] = questNameID;
                    }
                });

                const quest = {
                    [questNameID]: {
                        QuestName: questName,
                        _id: questNameID,
                        traderId: trader,
                        type: questType,
                        location: questlocation,
                        image: questImage,
                        instantComplete: false,
                        isKey: false,
                        secretQuest: false,
                        side: "Pmc",
                        sideExclusive: faction,
                        description: `${questNameID} description`,
                        startedMessageText: `${questNameID} startedMessageText`,
                        successMessageText: `${questNameID} successMessageText`,
                        failMessageText: `${questNameID} failMessageText`,
                        acceptPlayerMessage: `${questNameID} acceptPlayerMessage`,
                        declinePlayerMessage: `${questNameID} declinePlayerMessage`,
                        completePlayerMessage: `${questNameID} completePlayerMessage`,
                        changeQuestMessageText: `${questNameID} changeQuestMessageText`,
                        name: `${questNameID} name`,
                        note: `${questNameID} note`,
                        restartable: false,
                        canShowNotificationsInGame: true,
                        conditions: {
                            AvailableForFinish: conditions,
                            AvailableForStart: availableForStartConditions,
                            Fail: failConditions
                        },
                        rewards: {
                            Fail: [],
                            Started: startedRewards,
                            Success: rewards
                        }
                    }
                };

                // Output Display
                const questContent = JSON.stringify({ [questNameID]: quest[questNameID] }, null, 2);
                const languageEntriesContent = JSON.stringify(languageEntries, null, 2);
                const assortmentsContent = JSON.stringify(assortments, null, 2).slice(1, -1);

                document.getElementById('output').textContent = questContent;
                document.getElementById('language-output').textContent = languageEntriesContent;
                document.getElementById('assortments-output').textContent = assortmentsContent;

                updateDynamicQuestPath();
                updateDynamicLangPath();
                document.getElementById('quest-output-section').style.display = 'block';
                if (languageEntriesContent.length > 0) {
                    document.getElementById('language-output-section').style.display = 'block';
                }

                if (assortments.length > 0) {
                    document.getElementById('assortments-output-section').style.display = 'block';
                }
            }
        
        </script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-23WNPRN88E"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-23WNPRN88E');
        </script>
    </div>
</body>
</html>
